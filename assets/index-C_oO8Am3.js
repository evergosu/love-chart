var M=Object.defineProperty;var B=(p,e,t)=>e in p?M(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var r=(p,e,t)=>B(p,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();class H{constructor(e,t,i,s){r(this,"currentDay",0);r(this,"lastDay");this.man=e,this.woman=t,this.collision=i,this.lastDay=s}simulateDay(){this.woman.liveOneDay(this.currentDay),this.man.liveOneDay(this.currentDay),this.collision.check(this.currentDay),this.collision.brakeUpDay&&(this.lastDay=Math.floor(this.collision.brakeUpDay*1.5)),this.woman.save(),this.man.save(),this.currentDay++}simulateLife(){for(;this.currentDay<this.lastDay;)this.simulateDay()}}class v{constructor(e,t,i,s,a,o=[],n=[],h=[],c=[],k){r(this,"decayDuration");r(this,"decayStep");r(this,"_discontent",0);r(this,"breakupEmojis",U);r(this,"valueHistory",[]);r(this,"thoughtHistory",[]);r(this,"stressUntilDay",0);r(this,"defaultDiscontentDelta",1e-4);r(this,"mood","neutral");r(this,"emotionSharpness",1.5);this.value=e,this.emotionality=t,this.breakupReasons=i,this.thoughtList=s,this.emojiList=a,this.exGoodQuotes=o,this.exGoodEmojis=n,this.exBadQuotes=h,this.exBadEmojis=c;const[y,u]=k;this.decayDuration=Math.floor(Math.random()*(u-y)+y),this.decayStep=(e-100)/this.decayDuration}set discontent(e){this._discontent=Math.max(0,Math.min(1,e))}get discontent(){return this._discontent}addDiscontent(e=this.defaultDiscontentDelta){this.discontent+=e}retainDiscontent(){this.discontent>0&&(this.discontent=Math.max(0,this.discontent-this.defaultDiscontentDelta))}maybeTriggerStressPeriod(e,t=!1){(t||e>this.stressUntilDay&&Math.random()<.05)&&(this.stressUntilDay=e+Math.floor(5+Math.random()*5))}liveOneDay(e,t="casual"){this.maybeTriggerStressPeriod(e,t==="stress"),e<=this.stressUntilDay?this.emotionSharpness=1.1:this.emotionSharpness=1.5;const i=(Math.random()-.5-this.discontent)*2,s=Math.sign(i)*Math.pow(Math.abs(i),this.emotionSharpness),a=this.valueHistory.at(0)??100,o=(this.value-a*.1)/(a*.9),n=a*this.emotionality,h=1/(1+Math.pow(2*(o-.5),4)),c=n*s*h;this.emote(c)}emote(e){this.value+=e}save(){this.valueHistory.push(this.value)}saveThought(e){this.thoughtHistory.push(e)}}r(v,"MOOD_BIAS",{happy:20,fine:15,calm:10,neutral:0,worry:-10,stress:-25,sad:-30,mad:-35,collapsed:-50});const U={"fells out of love":"😔","wants different pace":"😬","emotionally drained":"🥱","lack of freedom":"😵","lack of understanding":"😕","lack of trust":"😒","unmet expectations":"😐","lack of common goals":"😔"};class L{constructor(e,t){r(this,"brokeUp",null);r(this,"brakeUpDay",null);r(this,"relationshipState","Beguin");r(this,"loveState","PerfectLove");r(this,"reason","fells out of love");r(this,"capacityLooseDay",null);this.man=e,this.woman=t}updateThoughts(e,t,i=0,s){if(this.brakeUpDay&&e>=this.brakeUpDay)return i;const a=Math.min(20,Math.sqrt(t.discontent)*2),o=Math.floor(Math.random()*(a*2+1))-a,n=Math.max(-50,Math.min(49,v.MOOD_BIAS[t.mood]+o));let h=2;return(t.mood==="happy"||t.mood==="sad")&&(h=4),i!=null&&Math.abs(i-n)<=5&&s<h?i:n}getThoughtStreak(e,t){const i=e.at(t-1);if(i==null)return 0;let s=1;for(let a=t-2;a>=0&&e[a]===i;a--)s++;return s}checkThoughts(e){const t=this.man.thoughtHistory.at(e-1)??0,i=this.getThoughtStreak(this.man.thoughtHistory,e),s=this.woman.thoughtHistory.at(e-1)??0,a=this.getThoughtStreak(this.woman.thoughtHistory,e),o=this.updateThoughts(e,this.man,t,i),n=this.updateThoughts(e,this.woman,s,a);this.man.saveThought(o),this.woman.saveThought(n)}isHumanBelowForLongTime(e,t,i){const s=e.valueHistory;let a=0;for(let o=0;o<s.length;o++)if(s[o]<t){if(a++,a>=i)return!0}else a=0;return!1}isHumanAboveForLongTime(e,t,i){const s=e.valueHistory;let a=0;for(let o=0;o<s.length;o++)if(s[o]>t){if(a++,a>=i)return!0}else a=0;return!1}isStagnant(e,t){const i=e.valueHistory;if(i.length<t)return!1;const s=i.slice(-t),a=Math.min(...s),o=Math.max(...s);return Math.abs(o-a)<3}isDetachedForLongTime(e,t){const i=this.man.valueHistory,s=this.woman.valueHistory,a=Math.min(i.length,s.length);let o=0;for(let n=0;n<a;n++)if(Math.abs(i[n]-s[n])>e){if(o++,o>=t)return!0}else o=0;return!1}valueDroppedFast(e,t,i){const s=e.valueHistory;return s.length<t?!1:s.at(-1)-s.at(-t)<-i}setBreakup(e,t,i){this.brakeUpDay=e,this.brokeUp=t,this.reason=i}checkBreakup(e){if(this.brakeUpDay==null){if(e<=14&&this.woman.value<this.man.capacity*.63){this.setBreakup(e,"man","unmet expectations");return}if(e<=14&&this.man.value<this.woman.value*.72){this.setBreakup(e,"woman","unmet expectations");return}if(e<=60&&this.isDetachedForLongTime(72,7)){this.setBreakup(e,"man","wants different pace");return}if(e<=60&&this.isDetachedForLongTime(54,14)){this.setBreakup(e,"woman","wants different pace");return}if(e<=180&&this.man.discontent>.0103){this.setBreakup(e,"man","fells out of love");return}if(e<=180&&this.woman.discontent>.0101){this.setBreakup(e,"woman","fells out of love");return}if(e<300&&this.isHumanAboveForLongTime(this.man,this.man.capacity*.6,190)&&this.isHumanAboveForLongTime(this.woman,this.man.capacity,190)){this.setBreakup(e,"man","lack of freedom");return}if(e<300&&this.isStagnant(this.woman,17)&&this.isHumanBelowForLongTime(this.woman,this.man.capacity*.1,17)&&this.isHumanAboveForLongTime(this.man,this.man.capacity*.7,17)){this.setBreakup(e,"woman","lack of freedom");return}if(e<400&&this.man.discontent>.026&&this.man.discontent>this.woman.discontent){this.setBreakup(e,"man","lack of understanding");return}if(e<400&&this.woman.discontent>.015&&this.woman.discontent>this.man.discontent){this.setBreakup(e,"woman","lack of understanding");return}if(this.valueDroppedFast(this.woman,77,this.man.capacityHistory.at(0))){this.setBreakup(e,"man","lack of trust");return}if(this.valueDroppedFast(this.man,52,this.woman.initialManCapacity*.5)){this.setBreakup(e,"woman","lack of trust");return}if(this.woman.value>this.man.value&&this.man.value<this.man.capacity*.1&&this.isStagnant(this.man,65)){this.setBreakup(e,"man","emotionally drained");return}if(this.woman.value<this.man.value*.2&&this.woman.value>0&&this.isStagnant(this.woman,10)){this.setBreakup(e,"woman","emotionally drained");return}if(e>1815){this.checkLackOfCommonGoals(e);return}}}checkLackOfCommonGoals(e){const i=this.man.valueHistory,s=this.woman.valueHistory;if(i.length<125||s.length<125)return;const a=i.slice(-125).reduce((n,h)=>n+h,0)/125,o=s.slice(-125).reduce((n,h)=>n+h,0)/125;a>this.man.capacity*.1&&s.slice(-125).some(n=>n<0)?this.setBreakup(e,"man","lack of common goals"):o>-a*40&&this.setBreakup(e,"woman","lack of common goals")}getRelationshipState(e){return this.brakeUpDay&&e>this.brakeUpDay?(this.man.retainDiscontent(),this.woman.retainDiscontent(),"Breakup"):e<this.man.decayDuration||e<this.woman.decayDuration?"Beguin":"Love"}getLoveState(e,t,i){return e>=0?e>i?"SheIsStressing_HeIsMad":e>t?"SheIsFine_HeIsStressing":"PerfectLove":e<-t?e<-i?"SheIsBroken_HeIsBroken":"SheIsMad_HeIsStressing":"SheIsStressing_HeIsFine"}setRelationshipState(e){this.relationshipState=this.getRelationshipState(e),this.relationshipState==="Love"&&(this.loveState=this.getLoveState(this.woman.value,this.man.value,this.man.capacity))}trackCapacityLoss(e){const t=this.man.capacity,i=this.woman.value,s=this.woman.valueHistory.at(e-1),a=i>=t&&s<this.man.capacityHistory.at(e-1),o=i<=-t*.3&&s>-this.man.capacityHistory.at(e-1)*.3,n=i<t&&i>-t*.3;if(this.capacityLooseDay===null&&(a||o)){this.man.looseCapacity(),this.capacityLooseDay=e;return}this.capacityLooseDay!==null&&n&&e-this.capacityLooseDay<=5&&(this.man.retainCapacity(),this.capacityLooseDay=null),this.capacityLooseDay!==null&&e-this.capacityLooseDay>5&&(this.capacityLooseDay=null)}check(e){switch(this.setRelationshipState(e),this.checkThoughts(e),this.checkBreakup(e),this.relationshipState){case"Beguin":this.man.mood="neutral",this.woman.mood="neutral";break;case"Breakup":{this.man.mood="sad",this.woman.mood="sad",this.man.retainDiscontent(),this.woman.retainDiscontent(),this.man.looseCapacity(.99);break}case"Love":{switch(this.loveState){case"SheIsStressing_HeIsMad":{this.trackCapacityLoss(e),this.woman.mood="stress",this.man.mood="mad",this.man.addDiscontent(),this.woman.addDiscontent();break}case"SheIsFine_HeIsStressing":{this.trackCapacityLoss(e),this.woman.mood="fine",this.man.mood="stress",this.woman.retainDiscontent(),this.man.addDiscontent();break}case"PerfectLove":{this.woman.mood="happy",this.man.mood="happy",this.man.retainDiscontent(),this.woman.retainDiscontent();break}case"SheIsStressing_HeIsFine":{this.trackCapacityLoss(e),this.woman.mood="stress",this.man.mood="fine",this.woman.addDiscontent();break}case"SheIsMad_HeIsStressing":{this.trackCapacityLoss(e),this.woman.mood="mad",this.man.mood="stress",this.man.addDiscontent(),this.woman.addDiscontent();break}case"SheIsBroken_HeIsBroken":{this.trackCapacityLoss(e),this.woman.mood="collapsed",this.man.mood="collapsed",this.man.addDiscontent(),this.woman.addDiscontent();break}default:{const t=this.loveState;throw new Error(`Unhandled love state: ${t}`)}}break}default:{const t=this.relationshipState;throw new Error(`Unhandled relationship state: ${t}`)}}}}class P extends v{constructor(t,i,s){super(t,.08,E,C,I,R,F,A,$,i);r(this,"theseDays",30);r(this,"amplitude",40);this.value=t,this.initialManCapacity=s}liveOneDay(t){this.decayValue(t),t%this.theseDays===0?super.liveOneDay(t,"stress"):super.liveOneDay(t)}decayValue(t){t<=this.decayDuration&&(Math.abs(this.value)<1.7?this.value=0:this.value+=this.value>0?-1.7:1.7)}emote(t){this.value+=t;const i=this.initialManCapacity;this.value>i?this.value=i-(this.value-i)*.5:this.value<-i&&(this.value=-i-(this.value+i)*.5)}}const I=["😐","🙂","😌","😊","☺️","😇","😉","😃","😄","😁","😆","😋","😎","😍","🤩","🥰","😘","😚","😙","🤗","😺","😻","😀","😸","😽","🤭","🫶","😇","😄","😃","😆","🥰","😎","🤗","😘","😋","😌","😊","😄","😀","🥹","☺️","😉","😇","😌","😙","😃","😽","😄","🥰","😍","😱","😨","😰","😖","😣","🥺","😢","😭","☹️","🙁","😞","😟","😔","😩","😫","🥴","😵‍💫","🥵","🥶","😓","😿","😾","😒","😤","😠","😡","🤬","😶","😑","🫥","🫠","😵","🤯","😬","🙄","😩","😮‍💨","😷","🤢","🤮","😕","😖","😣","😔","😓","😶‍🌫️","😢","😭","😩","😿","😞"],C=["Мне всё равно","Ну и ладно","Я спокойна","Пусть будет так","Он не раздражает","Нормально","Всё привычно","У меня свои дела","Пока всё терпимо","Он не мешает","Я держусь","Иногда даже приятно","Интересно наблюдать","Он старается","Может, не всё плохо","Он может быть милым","У нас есть моменты","С ним бывает тепло","Он рядом","Мне не одиноко","Он нужен мне","Я чувствую себя лучше","Он делает меня счастливой","Он важен для меня","Я улыбаюсь рядом с ним","Мне с ним спокойно","Я люблю, когда он рядом","Он заботится","Я могу доверять ему","Он видит меня","Я люблю его","Он моё всё","Я счастлива","Он наполняет меня","Я думаю о нём","С ним я расцветаю","Я чувствую себя живой","Он меня понимает","С ним безопасно","Он моя опора","Он часть меня","Мне хорошо","Это мой человек","Я его люблю","Это настоящее","Он смысл моего дня","Я его берегу","Я нашла своего","Это взаимно","Это любовь","Я счастлива как никогда","Мне больно","Он меня не слышит","Я одна","Я ему не важна","Меня игнорируют","Он холодный","Я не нужна","Я устала","Меня это мучает","Я пустая","Я больше не верю","Я разочарована","Он причиняет боль","Я жду напрасно","Меня не ценят","Это не любовь","Я ничего не чувствую","Мне страшно","Мне плохо","Он меня разрушает","Я теряю себя","Я с ним исчезаю","Он давит на меня","Он меня ломает","Мне тяжело","Я без сил","Мне плохо с ним","Я слабею","Я не хочу быть с ним","Он всё разрушил","Я не могу больше","Я плачу","Я в тишине","Я не справляюсь","Я просто терплю","Я не узнаю себя","Меня нет","Он не со мной","Я хочу уйти","Он чужой","Я не его","Меня нет в этом","Я потеряна","Это больше не важно","Мне всё равно","Он исчезает","Между нами пустота","Ничего не осталось","Я в темноте","Это больно","Я не нужна"],E={"fells out of love":"Моё сердце остыло","wants different pace":"Он тянет и тянет...","emotionally drained":"Я устала от этого","lack of freedom":"Я потеряла свободу","lack of understanding":"Он не слышит меня","lack of trust":"Я ему не доверяю","unmet expectations":"Это не то, что я хотела","lack of common goals":"Мы хотим разного"},R=["С ним я была счастливой","Он был заботливым и добрым","У нас были чудесные моменты","Иногда мне его не хватает","Он знал, как меня поддержать"],F=["😊","🙂","🥲","😌","😇"],A=["Он разбил мне сердце","Я устала от борьбы за нас","Он никогда не понимал меня","Он был не тем, за кого себя выдавал","Я была несчастна с ним"],$=["😢","😞","😔","😠","😩"];class j extends v{constructor(t,i){super(t,.03,Y,W,X,O,G,_,Q,i);r(this,"capacityHistory",[]);this.capacity=t}liveOneDay(t){this.decayCapacity(t),super.liveOneDay(t)}emote(t){if(this.value+=t,this.value>this.capacity){const i=this.value-this.capacity;this.value=this.capacity-i}else this.value<0&&(this.value=-this.value)}decayCapacity(t){if(t<=this.decayDuration){const i=t/this.decayDuration;this.capacity=this.capacity-i**2*(this.capacity-100)}}save(){super.save(),this.capacityHistory.push(this.capacity)}looseCapacity(t=.9){this.capacity*=t}retainCapacity(){this.capacity/=Math.sqrt(.9)}}const X=["😐","🙂","😌","😊","☺️","😇","😉","😃","😄","😁","😆","😋","😎","😍","🤩","🥰","😘","😚","😙","🤗","😺","😻","😀","😸","😽","🤠","😇","😄","😃","😁","😆","😅","😺","😎","🤗","🥰","😘","😋","😌","😊","😄","😀","☺️","😉","😇","😎","🙂","😃","😄","😙","😽","😱","😨","😰","😖","😣","🥺","😢","😭","☹️","🙁","😞","😟","😔","😩","😫","🥴","😵‍💫","🥵","🥶","😓","😿","😾","😒","😤","😠","😡","🤬","😶","😑","🫥","🫠","😵","🤯","😬","🙄","😩","😮‍💨","😷","🤢","🤮","😕","😖","😣","😔","😓","😶‍🌫️","😢","😭","😩","😿","😞"],W=["Всё ровно","Пожалуй, всё хорошо","Настроение получше","Она рядом — и это радует","Чувствую лёгкость","Мне спокойно","Мне нравится быть с ней","Всё светлее","Она делает мой день","Улыбаюсь внутри","С ней тепло","Хорошо, что мы вместе","Мне повезло","Мы подходим друг другу","Чувствую себя собой","Сердце спокойно","У нас получается","Хочется её обнять","Она меня понимает","Это приятно","Я чувствую любовь","Она важна для меня","Я хочу её радовать","Она приносит свет","Люблю её голос","Я влюблён","Мы в гармонии","С ней хорошо молчать","Я счастлив","Каждый день с ней лучше","Я дышу ей","Хочу быть рядом всегда","Она — часть меня","Ничего не нужно, кроме неё","Она всё для меня","Мы одно целое","С ней безопасно","Она — мой дом","Она даёт мне силы","Я нашёл своё","Это любовь","Она вдохновляет меня","С ней всё возможно","Я спокоен рядом с ней","Я ей доверяю","Она моя опора","Я становлюсь лучше с ней","Внутри свет","Я живу","Я счастлив по-настоящему","Это невыносимо","Я не знаю, что делать","Мне больно","Кажется, я теряю её","Она отдаляется","Я ей не нужен","Я в одиночестве","Нас ничего не связывает","Меня не слышат","Она холодна","Меня будто нет","Мне тяжело","Я разочарован","Всё рушится","Я в отчаянии","Она меня ранит","Мы чужие","Я устал","Не хочу продолжать","Я в тупике","Я пустой","Она злая","Я один","Нет смысла","Она меня игнорирует","Это конец","Я без сил","Мне страшно","Я не справляюсь","Я кричу внутри","Это ломает меня","Я ненавижу всё","Она всё разрушила","Мне невыносимо с ней","Я умираю внутри","Она жестока","Больше нет любви","Я не важен","Я сломлен","Это боль","Я исчезаю","Она меня оттолкнула","Я не нужен","Мне плохо","Мне всё равно","Я сдаюсь","Я ничего не чувствую","Тоска","Я потерян","Мне хочется уйти","Я один и всегда был"],Y={"fells out of love":"Больше не люблю её","wants different pace":"Она слишком торопит","emotionally drained":"Я опустошён","lack of freedom":"Меня душит эта связь","lack of understanding":"Она меня не понимает","lack of trust":"Я не могу ей доверять","unmet expectations":"Это не то, чего я ждал","lack of common goals":"У нас разные пути"},O=["Она была светом в моей жизни","С ней я чувствовал себя живым","Мы пережили много хорошего вместе","Иногда скучаю по её улыбке","Она делала меня лучше"],G=["😌","😊","🙂","🥲","😇"],_=["С ней я терял себя","Она разрушила моё доверие","Я больше не хочу таких отношений","Всё было ложью","Хуже было только одиночество"],Q=["😞","😔","😤","😠","😩"];class w{constructor(e){r(this,"ctx");r(this,"logicalHeight",0);r(this,"logicalWidth",0);r(this,"scale",1);r(this,"mapX",e=>e);this.canvas=e,this.ctx=e.getContext("2d"),this.adaptCanvasToContainer(e)}adaptCanvasToContainer(e){this.resize=this.resize.bind(this),this.resize(),new ResizeObserver(this.resize).observe(e)}resize(){const e=window.devicePixelRatio||1,t=this.canvas.getBoundingClientRect(),i=Math.floor(t.width*e),s=Math.floor(t.height*e);(this.canvas.width!==i||this.canvas.height!==s)&&(this.canvas.width=i,this.canvas.height=s,this.logicalWidth=t.width,this.logicalHeight=t.height,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(e,e))}mapY(e){return this.logicalHeight/2-e*this.scale}drawCanvas(e,t,i){this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight),this.mapX=s=>(s-e)/t*this.logicalWidth,this.scale=this.logicalHeight/2*.8/i,this.ctx.lineWidth=2*this.scale}}class q extends w{constructor(e){super(e)}drawAxis(){this.ctx.save(),this.ctx.strokeStyle="#888",this.ctx.beginPath(),this.ctx.moveTo(0,this.mapY(0)),this.ctx.lineTo(this.logicalWidth,this.mapY(0)),this.ctx.stroke(),this.ctx.restore()}drawBlueTunnel(e,t,i){this.ctx.save(),this.ctx.fillStyle="rgba(100, 149, 237, 0.2)",this.ctx.beginPath(),this.ctx.moveTo(this.mapX(t),this.mapY(e[t]));for(let s=t;s<=i;s++)this.ctx.lineTo(this.mapX(s),this.mapY(e[s]));for(let s=i;s>=t;s--)this.ctx.lineTo(this.mapX(s),this.mapY(-e[s]));this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()}drawGrayTunnel(e,t,i){this.ctx.save(),this.ctx.fillStyle="rgba(160, 160, 160, 0.2)",this.ctx.beginPath(),this.ctx.moveTo(this.mapX(t),this.mapY(e[t]));for(let s=t;s<=i;s++)this.ctx.lineTo(this.mapX(s),this.mapY(e[s]));for(let s=i;s>=t;s--)this.ctx.lineTo(this.mapX(s),this.mapY(-e[s]));this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()}drawTunnel(e,t,i,s,a){const o=Math.max(s,0),n=t.brakeUpDay!=null&&t.brakeUpDay<i?t.brakeUpDay:Math.min(i,s+a);if(this.drawBlueTunnel(e,o,n),t.brakeUpDay!=null){const h=Math.max(s,t.brakeUpDay);this.drawGrayTunnel(e,h,i)}}clampToTunnel(e,t){return Math.max(-t,Math.min(t,e))}drawManValueLine(e,t,i,s,a,o){const n=Math.max(a,0),h=i.brakeUpDay!=null&&i.brakeUpDay<s?i.brakeUpDay:Math.min(s,a+o);this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="rgba(100, 149, 237, 1)",this.ctx.moveTo(this.mapX(n),this.mapY(this.clampToTunnel(e[n],t[n])));for(let c=n;c<=h;c++){const k=this.clampToTunnel(e[c],t[c]);this.ctx.lineTo(this.mapX(c),this.mapY(k))}this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle="#aaa";for(let c=h;c<=s;c++)this.ctx.lineTo(this.mapX(c),this.mapY(this.clampToTunnel(e[c],t[c])));this.ctx.stroke(),this.ctx.restore()}drawRedLine(e,t,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="#ff4f8b",this.ctx.moveTo(this.mapX(t),this.mapY(e[t])),t&&this.ctx.moveTo(this.mapX(t),this.mapY(e[t]));for(let s=t;s<=i;s++)this.ctx.lineTo(this.mapX(s),this.mapY(e[s]));this.ctx.stroke(),this.ctx.restore()}drawGrayLine(e,t,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="#aaa";let s=0,a=e[t],o=!1;this.ctx.moveTo(this.mapX(t),this.mapY(a));for(let n=t;n<i;n++){const h=e[n];o?this.ctx.lineTo(this.mapX(n),this.mapY(s)):((h===0||h*a<0)&&(o=!0,s=h),this.ctx.lineTo(this.mapX(n),this.mapY(h)),a=h)}this.ctx.stroke(),this.ctx.restore()}drawWomanLine(e,t,i,s,a){const o=Math.max(s,0),n=t.brakeUpDay!=null&&t.brakeUpDay<i?t.brakeUpDay:Math.min(i,s+a);this.drawRedLine(e,o,n),t.brakeUpDay!=null&&i>t.brakeUpDay&&this.drawGrayLine(e,n,i)}drawMarker(e,t,i){const s=this.mapX(e),a=this.mapY(t);this.ctx.save(),this.ctx.fillStyle="#000",this.ctx.font="24px sans-serif",this.ctx.textAlign="center",this.ctx.fillText("✂️",s,this.mapY(-10)),this.ctx.beginPath(),this.ctx.moveTo(s,this.mapY(0)),this.ctx.lineTo(s,a),this.ctx.strokeStyle="#000",this.ctx.stroke(),this.ctx.fillText(i,s,a),this.ctx.restore()}drawBreakup(e,t,i,s){if(i.brakeUpDay!=null&&s>=i.brakeUpDay){const a=i.brokeUp==="man",o=a?-e[i.brakeUpDay]:t[i.brakeUpDay],n=a?"♂️":"♀️";this.drawMarker(i.brakeUpDay,o,n)}}drawOverlayInfo(e,t,i,s){const a=this.ctx,o=6,n=14,h=[];h.push(`day: ${s}`),h.push(`M capacity: ${Math.floor(e.capacityHistory[s])}`),h.push(`M value: ${Math.floor(e.valueHistory[s])}`),h.push(`W value: ${Math.floor(t.valueHistory[s])}`),h.push(`M discontent: ${e.discontent}`),h.push(`W discontent: ${t.discontent}`),h.push(`r state: ${i.relationshipState}`),h.push(`l state: ${i.loveState}`),h.push(`b day: ${i.brakeUpDay}`),h.push(`b by: ${i.brokeUp}`),h.push(`b reason: ${i.reason}`);const c=180,k=o*2+h.length*n,y=this.logicalWidth-c-10,u=10;a.save(),a.fillStyle="rgba(0,0,0,0.6)",a.fillRect(y,u,c,k),a.font=`${n-2}px monospace`,a.fillStyle="#fff",a.textBaseline="top";for(let d=0;d<h.length;d++)a.fillText(h[d],y+o,u+o+d*n);a.restore()}draw(e,t,i,s,a,o,n,h){this.drawCanvas(o,n,h),this.drawTunnel(e,s,a,o,n),this.drawManValueLine(i,e,s,a,o,n),this.drawWomanLine(t,s,a,o,n),this.drawBreakup(e,t,s,a),this.drawAxis()}}class z extends w{constructor(t){super(t);r(this,"currentSpacing",0);r(this,"offset",0)}drawCharacter(t,i,s){const a=40*this.scale,o=20*this.scale,n=20*this.scale,h=this.logicalHeight/1.2-(a+o/2)*this.scale;this.offset=h,this.ctx.save(),this.ctx.strokeStyle=s,this.ctx.fillStyle=s,this.ctx.lineWidth=8*this.scale,this.ctx.beginPath(),this.ctx.moveTo(t,h),this.ctx.lineTo(t,h+a),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t-n,h+a/2),this.ctx.lineTo(t+n,h+a/2),this.ctx.stroke();const c=h+a;this.ctx.beginPath(),this.ctx.moveTo(t,c),this.ctx.lineTo(t-o,c+o),this.ctx.moveTo(t,c),this.ctx.lineTo(t+o,c+o),this.ctx.stroke(),this.ctx.font=`${42*this.scale}px serif`,this.ctx.textAlign="center",this.ctx.fillText(i,t,h+8*this.scale),this.ctx.restore()}drawSpeechBubble(t,i,s,a,o,n){t.font="14px sans-serif";const u=t.measureText(i).width+10*2,d=this.logicalWidth,f=6;let l=s-u/2;n?(l+=80*this.scale,l+u>d-f&&(l=d-f-u),l<f&&(l=f)):(l-=80*this.scale,l<f&&(l=f),l+u>d-f&&(l=d-f-u));const m=o==="up"?a-24-60*this.scale:a+10*this.scale,g=l+u/2;t.save(),t.beginPath(),t.moveTo(l+10,m),t.lineTo(l+u-10,m),t.quadraticCurveTo(l+u,m,l+u,m+10),t.lineTo(l+u,m+24-10),t.quadraticCurveTo(l+u,m+24,l+u-10,m+24),t.lineTo(l+10,m+24),t.quadraticCurveTo(l,m+24,l,m+24-10),t.lineTo(l,m+10),t.quadraticCurveTo(l,m,l+10,m),t.closePath(),t.fillStyle="rgba(0,0,0,0.7)",t.fill(),t.beginPath(),t.moveTo(s,this.offset-20),o==="up"?(t.lineTo(g-6,m+24),t.lineTo(g+6,m+24)):(t.lineTo(g-6,m),t.lineTo(g+6,m)),t.closePath(),t.fill(),t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText(i,g,m+24/2),t.restore()}drawThoughts(t,i,s,a,o,n){let h=t.thoughtList.at(t.thoughtHistory.at(o));n.brakeUpDay&&o>=n.brakeUpDay&&n.brokeUp==="man"&&(h=t.breakupReasons[n.reason],o===t.valueHistory.length-1&&(t.valueHistory[o]>t.valueHistory[n.brakeUpDay]?h=t.exGoodQuotes[Math.floor(Math.random()*t.exGoodQuotes.length)]:h=t.exBadQuotes[Math.floor(Math.random()*t.exBadQuotes.length)])),this.drawSpeechBubble(this.ctx,h,i,this.offset-20*this.scale,"up",!1);let c=t.thoughtList.at(t.thoughtHistory.at(o));n.brakeUpDay&&o>=n.brakeUpDay&&n.brokeUp==="woman"&&(c=s.breakupReasons[n.reason],o===s.valueHistory.length-1&&(s.valueHistory[o]>s.valueHistory[n.brakeUpDay]?c=s.exGoodQuotes[Math.floor(Math.random()*s.exGoodQuotes.length)]:c=s.exBadQuotes[Math.floor(Math.random()*s.exBadQuotes.length)])),this.drawSpeechBubble(this.ctx,c,a,this.offset-50*this.scale,"up",!0)}drawSurvived(){const t=this.ctx;t.save(),t.fillStyle="rgba(255, 0, 0, 0.15)",t.fillRect(0,0,this.logicalWidth,this.logicalHeight),t.font=`bold ${80*this.scale}px serif`,t.textAlign="center",t.textBaseline="middle",t.fillStyle="#e00",t.fillText("❤️",this.logicalWidth/2,this.logicalHeight/2-95*this.scale),t.font=`bold ${10*this.scale}px sans-serif`,t.fillStyle="#000",t.fillText("they lived to die on the same day",this.logicalWidth/2,this.logicalHeight/10),t.restore()}draw(t,i,s,a,o,n,h){this.drawCanvas(0,n,h);const c=Math.max(0,Math.min(a,t.valueHistory.length-1,i.valueHistory.length-1));this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight);const k=this.logicalWidth*.8,y=Math.abs(i.valueHistory[c]-t.valueHistory[c])*2,u=Math.min(y,k),d=this.logicalWidth/2,f=.1;this.currentSpacing+=(u-this.currentSpacing)*f;const l=d-this.currentSpacing/2,m=d+this.currentSpacing/2;let g=t.emojiList.at(t.thoughtHistory.at(a));s.brakeUpDay&&a>=s.brakeUpDay&&s.brokeUp==="man"&&(g=t.breakupEmojis[s.reason],a===t.valueHistory.length-1&&(t.valueHistory[a]>t.valueHistory[s.brakeUpDay]?g=t.exGoodEmojis[Math.floor(Math.random()*t.exGoodEmojis.length)]:g=t.exBadEmojis[Math.floor(Math.random()*t.exBadEmojis.length)])),this.drawCharacter(l,g,"#4682B4");let D=i.emojiList.at(i.thoughtHistory.at(a));s.brakeUpDay&&a>=s.brakeUpDay&&s.brokeUp==="woman"&&(D=i.breakupEmojis[s.reason],a===i.valueHistory.length-1&&(i.valueHistory[a]>i.valueHistory[s.brakeUpDay]?D=i.exGoodEmojis[Math.floor(Math.random()*i.exGoodEmojis.length)]:D=i.exBadEmojis[Math.floor(Math.random()*i.exBadEmojis.length)])),this.drawCharacter(m,D,"#FF69B4"),this.drawThoughts(t,l,i,m,a,s),o&&this.drawSurvived()}}class N{constructor(){r(this,"currentDay");r(this,"brakeUpDay");r(this,"brokeUpBy");r(this,"brokeUpReason");this.currentDay=document.getElementById("current-day"),this.brokeUpBy=document.getElementById("broke-up-by"),this.brokeUpReason=document.getElementById("broke-up-reason"),this.brakeUpDay=document.getElementById("brake-up-day")}formatDuration(e){const t=Math.floor(e/365),i=Math.floor(e%365/30),s=Math.floor(e%30);return`${t.toString().padStart(2,"0")}y ${i.toString().padStart(2,"0")}m ${s.toString().padStart(2,"0")}d`}updateCurrentDay(e){this.currentDay.textContent=typeof e=="number"?this.formatDuration(e):e}updateBrakeUpDay(e){this.brakeUpDay.textContent=typeof e=="number"?this.formatDuration(e):e}updateBrokeUp(e,t){this.brokeUpBy.textContent=e,this.brokeUpReason.textContent=t}}class V{constructor(){r(this,"newAtMaxButton");r(this,"newAtMax");r(this,"down");r(this,"up");this.up=document.getElementById("speed-up"),this.down=document.getElementById("speed-down"),this.newAtMax=document.getElementById("new-at-max"),this.newAtMaxButton=document.getElementById("new-at-max-button"),this.newAtMaxButton.onclick=()=>window.location.reload()}updateNewAtMax(e){this.newAtMax.textContent=e.toString()}}class Z{constructor(e,t,i,s,a,o,n){r(this,"currentDay",0);r(this,"frameId",null);r(this,"graph");r(this,"isPlaying",!1);r(this,"lastTickTime",performance.now());r(this,"scene");r(this,"timeline");r(this,"info",new N);r(this,"controls",new V);r(this,"refreshRate",60);this.man=e,this.woman=t,this.collision=i,this.totalDays=s,this.daysPerSecond=a,this.frameDays=o,this.isDebug=n,this.totalDays=this.collision.brakeUpDay?s:365,this.estimateRefreshRate(c=>{this.refreshRate=c,console.log("Estimated refresh rate:",c,"Hz")});const h=Number(window.localStorage.getItem("daysPerSecond"));h?this.daysPerSecond=h:this.daysPerSecond=a,this.tick=this.tick.bind(this),this.graph=new q(document.getElementById("graph")),this.scene=new z(document.getElementById("scene")),this.timeline=document.getElementById("timeline"),this.controls.up.onclick=this.speedUp.bind(this),this.controls.down.onclick=this.speedDown.bind(this),this.setupCanvasDrag(document.getElementById("graph")),this.timeline.max=String(this.totalDays),this.timeline.oninput=()=>{this.seek(Number(this.timeline.value))}}estimateRefreshRate(e,t=60,i=[60,120,144,165,240]){const s=[];let a=performance.now();function o(n){const h=n-a;if(a=n,s.push(h),s.length<t)requestAnimationFrame(o);else{const c=s.filter(d=>d>5&&d<100),y=1e3/(c.reduce((d,f)=>d+f,0)/c.length),u=i.reduce((d,f)=>Math.abs(f-y)<Math.abs(d-y)?f:d);e(u)}}requestAnimationFrame(o)}speedUp(){this.daysPerSecond<10?this.daysPerSecond++:this.daysPerSecond+=10,window.localStorage.setItem("daysPerSecond",String(this.daysPerSecond))}speedDown(){this.daysPerSecond<=10?this.daysPerSecond=Math.max(1,this.daysPerSecond-1):this.daysPerSecond-=10,window.localStorage.setItem("daysPerSecond",String(this.daysPerSecond))}setupCanvasDrag(e){let t=!1,i=0;const s=a=>{const o=a-i;i=a;const n=Math.max(1,this.frameDays),h=e.clientWidth/n,c=Math.round(o/h);this.seek(this.currentDay-c)};e.addEventListener("mousedown",a=>{t=!0,i=a.clientX,this.pause()}),window.addEventListener("mousemove",a=>{t&&s(a.clientX)}),window.addEventListener("mouseup",()=>{t=!1,this.play()}),e.addEventListener("touchstart",a=>{a.touches.length===1&&(t=!0,i=a.touches[0].clientX,this.pause())},{passive:!0}),window.addEventListener("touchmove",a=>{!t||a.touches.length!==1||(a.preventDefault(),s(a.touches[0].clientX))},{passive:!1}),window.addEventListener("touchend",()=>{t=!1,this.play()})}updateFrame(e){const t=Math.max(0,e-this.frameDays);this.graph.draw(this.man.capacityHistory,this.woman.valueHistory,this.man.valueHistory,this.collision,Math.floor(e),Math.floor(t),this.frameDays,this.man.capacityHistory[0]),this.scene.draw(this.man,this.woman,this.collision,Math.floor(e)-1,this.collision.brakeUpDay==null&&e===this.totalDays,this.frameDays,this.man.capacityHistory[0]),this.isDebug&&this.graph.drawOverlayInfo(this.man,this.woman,this.collision,Math.floor(e)-1),this.timeline.value=String(e),this.updateViews(e)}updateViews(e){this.info.updateCurrentDay(e),this.collision.brakeUpDay&&e>=this.collision.brakeUpDay&&(this.info.updateBrokeUp(this.collision.brokeUp,this.collision.reason),this.info.updateBrakeUpDay(this.collision.brakeUpDay)),this.controls.updateNewAtMax(this.daysPerSecond)}play(){this.isPlaying||(this.isPlaying=!0,this.lastTickTime=performance.now(),this.frameId=requestAnimationFrame(e=>this.tick(e)))}pause(){this.frameId&&cancelAnimationFrame(this.frameId),this.isPlaying=!1}stop(){this.pause(),this.currentDay=0,this.frameId=null,this.lastTickTime=performance.now()}forward(e=10){this.pause(),this.currentDay=Math.min(this.totalDays,this.currentDay+e),this.lastTickTime=performance.now(),this.updateFrame(this.currentDay)}rewind(e=10){this.pause(),this.currentDay=Math.max(0,this.currentDay-e),this.lastTickTime=performance.now(),this.updateFrame(this.currentDay)}seek(e){this.pause();const t=Math.max(0,Math.min(this.totalDays,e));this.currentDay=t,this.lastTickTime=performance.now(),this.updateFrame(this.currentDay)}tick(e){if(!this.isPlaying)return;const t=(e-this.lastTickTime)/1e3;if(t<1/this.refreshRate){this.frameId=requestAnimationFrame(this.tick);return}if(this.lastTickTime=e,this.currentDay+=t*this.daysPerSecond,this.currentDay>=this.totalDays){this.currentDay=this.totalDays,this.updateFrame(this.currentDay),this.pause();return}this.updateFrame(this.currentDay),this.frameId=requestAnimationFrame(this.tick)}}const x=new j(150,[14,90]),b=new P(150,[14,90],x.capacity),S=new L(x,b),K=100*365,T=new H(x,b,S,K);T.simulateLife();const J=new Z(x,b,S,T.lastDay,30,365,!1);J.play();
