var v=Object.defineProperty;var k=(r,e,t)=>e in r?v(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e,t)=>k(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class b{constructor(e,t,s,i){h(this,"currentDay",0);h(this,"lastDay");this.man=e,this.woman=t,this.collision=s,this.lastDay=i}simulateDay(){this.woman.decay(this.currentDay),this.man.decay(this.currentDay),this.woman.changeEmotions(this.currentDay),this.collision.check(this.currentDay),this.collision.checkBreakup(this.currentDay),this.collision.brokenDay&&(this.man.retainDiscontent(),this.woman.retainDiscontent(),this.lastDay=Math.floor(this.collision.brokenDay*1.5)),this.woman.save(),this.man.save(),this.currentDay++}simulateLife(){for(;this.currentDay<this.lastDay;)this.simulateDay()}}class M{constructor(e,t){h(this,"bound","none");h(this,"startDay",0);h(this,"brokenBy",null);h(this,"brokenDay",null);this.man=e,this.woman=t}handleLower(e){this.woman.value>-this.man.value&&this.stop(e)<=2&&this.man.retainCapacity()}handleNone(e){this.woman.value>=this.man.value&&(this.start(e,"upper"),this.woman.addDiscontent()),this.woman.value>0&&this.man.resetDiscontent(),this.woman.value<=-this.man.value&&(this.start(e,"lower"),this.man.looseCapacity(),this.man.addDiscontent(),this.woman.resetDiscontent())}handlePersistentNeglect(){this.woman.value<-this.man.capacity/2&&this.man.isRageFromDiscontent()?this.man.looseCapacity():this.man.addDiscontent()}handleUpper(e){this.woman.value<this.man.value&&this.stop(e)>=2&&this.woman.hate()}shouldCollide(e){return e>this.man.decayDuration&&e>this.woman.decayDuration}start(e,t){this.bound=t,this.startDay=e}stop(e){const t=e-this.startDay;return this.bound="none",this.startDay=0,t}check(e){if(this.shouldCollide(e))switch(this.handlePersistentNeglect(),this.bound){case"none":this.handleNone(e);break;case"upper":this.handleUpper(e);break;case"lower":this.handleLower(e);break}}checkBreakup(e){if(this.brokenDay!=null)return;const t=this.man.value<Math.floor(this.man.capacity/3);(this.woman.value<-this.man.capacity*.8||t)&&(this.brokenDay=e,this.brokenBy=t?"man":"woman")}}class y{constructor(e,t){h(this,"decayDuration");h(this,"decayStep");h(this,"discontent",0);h(this,"history",[]);this.value=e;const[s,i]=t;this.decayDuration=Math.floor(Math.random()*(i-s)+s),this.decayStep=50/this.decayDuration}addDiscontent(){this.discontent++}hate(){this.discontent+=10}isRageFromDiscontent(){const e=Math.min(this.discontent*5,50);return Math.random()*100<=e}save(){this.history.push(this.value)}resetDiscontent(){this.discontent=0}retainDiscontent(){}}class T extends y{constructor(t,s,i){super(t,s);h(this,"bigEmotionDay",30);h(this,"smallEmotionDay",14);h(this,"amplitude",50);this.value=t,this.initialManCapacity=i}emote(t){this.value+=t}getEmotionAmplitude(){return this.amplitude*(1+this.discontent*.05)}addDiscontent(){super.addDiscontent(),this.emote(-(Math.random()*10+10))}changeEmotions(t){if(t>this.decayDuration){const s=this.getEmotionAmplitude();t%this.bigEmotionDay===0?this.emote((Math.random()-.5)*s):(t%this.smallEmotionDay===0||this.isRageFromDiscontent())&&this.emote((Math.random()-.5)*(s/2)),this.value=Math.max(-this.initialManCapacity,Math.min(this.initialManCapacity,this.value))}}decay(t){if(t<=this.decayDuration){const s=(Math.random()-.5)*this.decayStep*5,i=Math.random()<.9?-1:1;this.value+=i*(this.decayStep+s)}}retainDiscontent(){this.discontent>0&&(this.discontent-=this.discontent*.9)}}class C extends y{constructor(t,s){super(t,s);h(this,"resilience",0);h(this,"rancor",.9);this.capacity=t}decay(t){if(t<=this.decayDuration){const s=t/this.decayDuration;this.value=this.capacity-s**2*(this.capacity-100)}}looseCapacity(){this.resilience++,this.value*=this.rancor}retainCapacity(){this.value*=1+.03*this.resilience}retainDiscontent(){this.discontent>0&&(this.discontent-=this.discontent*.5)}}class p{constructor(e){h(this,"ctx");h(this,"logicalHeight",0);h(this,"logicalWidth",0);h(this,"scale",1);h(this,"mapX",e=>e);this.canvas=e,this.ctx=e.getContext("2d"),this.adaptCanvasToContainer(e)}adaptCanvasToContainer(e){this.resize(),new ResizeObserver(this.resize).observe(e)}resize(){const e=window.devicePixelRatio||1,t=this.canvas.getBoundingClientRect(),s=Math.floor(t.width*e),i=Math.floor(t.height*e);(this.canvas.width!==s||this.canvas.height!==i)&&(this.canvas.width=s,this.canvas.height=i,this.logicalWidth=t.width,this.logicalHeight=t.height,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(e,e))}mapY(e){return this.logicalHeight/2-e}drawCanvas(e,t){this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight),this.mapX=s=>(s-e)/t*this.logicalWidth,this.scale=this.logicalHeight/this.canvas.height,this.ctx.lineWidth=1*this.scale}}class E extends p{constructor(e){super(e)}drawAxis(){this.ctx.strokeStyle="#888",this.ctx.beginPath(),this.ctx.moveTo(0,this.mapY(0)),this.ctx.lineTo(this.logicalWidth,this.mapY(0)),this.ctx.stroke()}drawBlueTunnel(e,t,s){this.ctx.fillStyle="rgba(100, 149, 237, 0.15)",this.ctx.beginPath(),this.ctx.moveTo(this.mapX(t),this.mapY(e[t]));for(let i=t;i<s;i++)this.ctx.lineTo(this.mapX(i),this.mapY(e[i]));for(let i=s-1;i>=t;i--)this.ctx.lineTo(this.mapX(i),this.mapY(-e[i]));this.ctx.closePath(),this.ctx.fill()}drawGrayTunnel(e,t,s){this.ctx.fillStyle="rgba(160, 160, 160, 0.15)",this.ctx.beginPath(),this.ctx.moveTo(this.mapX(t),this.mapY(e[t]));for(let i=t;i<s;i++)this.ctx.lineTo(this.mapX(i),this.mapY(e[i]));for(let i=s-1;i>=t;i--)this.ctx.lineTo(this.mapX(i),this.mapY(-e[i]));this.ctx.closePath(),this.ctx.fill()}drawTunnel(e,t,s,i,n){const a=Math.max(i,0),o=t.brokenDay!=null&&t.brokenDay<s?t.brokenDay:Math.min(s,i+n);if(this.drawBlueTunnel(e,a,o),t.brokenDay!=null){const c=Math.max(i,t.brokenDay);this.drawGrayTunnel(e,c,s)}}drawRedLine(e,t,s){this.ctx.beginPath(),this.ctx.strokeStyle="#ff4f8b",this.ctx.moveTo(this.mapX(t),this.mapY(e[0])),t&&this.ctx.moveTo(this.mapX(t),this.mapY(e[t]));for(let i=t;i<s;i++)this.ctx.lineTo(this.mapX(i),this.mapY(e[i]));this.ctx.stroke()}drawGrayLine(e,t,s){this.ctx.beginPath(),this.ctx.strokeStyle="#aaa";let i=0,n=e[t],a=!1;this.ctx.moveTo(this.mapX(t),this.mapY(n));for(let o=t;o<s;o++){const c=e[o];a?this.ctx.lineTo(this.mapX(o),this.mapY(i)):((c===0||c*n<0)&&(a=!0,i=c),this.ctx.lineTo(this.mapX(o),this.mapY(c)),n=c)}this.ctx.stroke()}drawWomanLine(e,t,s,i,n){const a=Math.max(i,0),o=t.brokenDay!=null&&t.brokenDay<s?t.brokenDay:Math.min(s,i+n);this.drawRedLine(e,a,o),t.brokenDay!=null&&s>t.brokenDay&&this.drawGrayLine(e,o,s)}drawMarker(e,t,s){const i=this.mapX(e),n=this.mapY(t);this.ctx.fillStyle="#000",this.ctx.font="24px sans-serif",this.ctx.textAlign="center",this.ctx.fillText("âœ‚ï¸",i,this.mapY(-10)),this.ctx.beginPath(),this.ctx.moveTo(i,this.mapY(0)),this.ctx.lineTo(i,n),this.ctx.strokeStyle="#000",this.ctx.stroke(),this.ctx.fillText(s,i,n)}drawBreakup(e,t,s,i){if(s.brokenDay!=null&&i>=s.brokenDay){const n=s.brokenBy==="man",a=n?-e[s.brokenDay]:t[s.brokenDay],o=n?"â™‚ï¸":"â™€ï¸";this.drawMarker(s.brokenDay,a,o)}}draw(e,t,s,i,n,a){this.drawCanvas(n,a),this.drawAxis(),this.drawTunnel(e,s,i,n,a),this.drawWomanLine(t,s,i,n,a),this.drawBreakup(e,t,s,i)}}class P extends p{constructor(t){super(t);h(this,"currentSpacing",0)}drawCharacter(t,s,i,n){const a=s*this.scale;this.ctx.save(),this.ctx.strokeStyle=n,this.ctx.fillStyle=n,this.ctx.lineWidth=20*this.scale,this.ctx.beginPath(),this.ctx.moveTo(t,a+40),this.ctx.lineTo(t,a+80),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t-15,a+55),this.ctx.lineTo(t+15,a+55),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t,a+80),this.ctx.lineTo(t-10,a+100),this.ctx.moveTo(t,a+80),this.ctx.lineTo(t+10,a+100),this.ctx.stroke(),this.ctx.font="42px serif",this.ctx.textAlign="center",this.ctx.fillText(i,t,a+40),this.ctx.restore()}getEmoji(t,s,i){return s.brokenDay&&i>=s.brokenDay?"ðŸ’€":t.discontent>20?"ðŸ˜­":t.discontent>10?"ðŸ˜¡":t.discontent>5?"ðŸ˜•":t.value>140?"ðŸ˜":t.value>80?"ðŸ˜Š":t.value<60?"ðŸ¥º":"ðŸ˜"}draw(t,s,i,n,a){this.drawCanvas(0,a);const o=Math.max(0,Math.min(n,t.history.length-1,s.history.length-1));this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight);const c=Math.abs(s.history[o]-t.history[o])*2,d=this.logicalWidth/2,D=.1;this.currentSpacing+=(c-this.currentSpacing)*D;const x=d-this.currentSpacing/2,w=d+this.currentSpacing/2,u=this.logicalHeight/2;this.drawCharacter(x,u,this.getEmoji(t,i,o),"#4682B4"),this.drawCharacter(w,u,this.getEmoji(s,i,o),"#FF69B4")}}class B{constructor(e,t,s,i,n=10,a){h(this,"currentDay",0);h(this,"frameId",null);h(this,"isPlaying",!1);h(this,"lastTickTime",0);h(this,"graph");h(this,"scene");h(this,"timeline");if(this.man=e,this.woman=t,this.collision=s,this.totalDays=i,this.speed=n,this.frameDays=a,window.addEventListener("resize",()=>this.handleOrientationChange(),{once:!1}),this.isMobile()){const o=document.getElementById("player-controls");o&&(o.style.display="none")}this.handleOrientationChange(),this.graph=new E(document.getElementById("graph")),this.scene=new P(document.getElementById("scene")),this.timeline=document.getElementById("timeline"),document.getElementById("play").onclick=()=>this.play(),document.getElementById("pause").onclick=()=>this.pause(),document.getElementById("rewind").onclick=()=>this.rewind(30),document.getElementById("forward").onclick=()=>this.forward(30),this.setupCanvasDrag(document.getElementById("graph")),this.timeline.max=String(i),this.timeline.oninput=()=>this.seek(Number(this.timeline.value))}setupCanvasDrag(e){let t=!1,s=0;const i=e.clientWidth/this.frameDays,n=a=>{const o=a-s;s=a;const c=Math.round(o/i);this.seek(this.currentDay-c)};e.addEventListener("mousedown",a=>{t=!0,s=a.clientX}),window.addEventListener("mousemove",a=>{t&&n(a.clientX)}),window.addEventListener("mouseup",()=>{t=!1}),e.addEventListener("touchstart",a=>{a.touches.length===1&&(t=!0,s=a.touches[0].clientX)},{passive:!0}),window.addEventListener("touchmove",a=>{!t||a.touches.length!==1||(a.preventDefault(),n(a.touches[0].clientX))},{passive:!1}),window.addEventListener("touchend",()=>{t=!1})}updateFrame(){const e=Math.max(0,this.currentDay-this.frameDays);this.graph.draw(this.man.history,this.woman.history,this.collision,this.currentDay,e,this.frameDays),this.scene.draw(this.man,this.woman,this.collision,this.currentDay-1,this.frameDays),this.timeline.value=String(this.currentDay),this.currentDay++}play(){this.isPlaying||(this.isPlaying=!0,this.frameId=requestAnimationFrame(e=>this.tick(e)))}pause(){this.frameId&&cancelAnimationFrame(this.frameId),this.isPlaying=!1}stop(){this.pause(),this.currentDay=0,this.frameId=null,this.lastTickTime=0}forward(e=10){this.pause(),this.currentDay=Math.min(this.totalDays,this.currentDay+e),this.updateFrame()}rewind(e=10){this.pause(),this.currentDay=Math.max(0,this.currentDay-e),this.updateFrame()}seek(e){this.pause(),this.currentDay=Math.max(0,Math.min(this.totalDays,e)),this.updateFrame()}tick(e=0){this.currentDay<=this.totalDays?(e-this.lastTickTime>=this.speed&&(this.updateFrame(),this.lastTickTime=e),this.frameId=requestAnimationFrame(t=>this.tick(t))):this.stop()}isMobile(){return/Mobi|Android|iPhone/i.test(navigator.userAgent)}isPortrait(){return window.innerHeight>window.innerWidth}handleOrientationChange(){this.isMobile()&&(this.isPortrait()?(this.pause(),this.showRotateMessage()):(this.hideRotateMessage(),this.play()))}showRotateMessage(){const e=document.getElementById("message");e&&(e.style.display="flex")}hideRotateMessage(){const e=document.getElementById("message");e&&(e.style.display="none")}}const l=new C(150,[14,90]),m=new T(150,[14,90],l.value),f=new M(l,m),X=100*365,g=new b(l,m,f,X);g.simulateLife();const Y=new B(l,m,f,g.lastDay,10,365);Y.play();
