var M=Object.defineProperty;var T=(d,t,e)=>t in d?M(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var r=(d,t,e)=>T(d,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();class C{constructor(t,e,s,a){r(this,"currentDay",0);r(this,"lastDay");this.man=t,this.woman=e,this.collision=s,this.lastDay=a}simulateDay(){this.woman.decay(this.currentDay),this.man.decay(this.currentDay),this.woman.changeEmotions(this.currentDay),this.collision.check(this.currentDay),this.collision.checkBreakup(this.currentDay),this.collision.brokenDay&&(this.man.retainDiscontent(),this.woman.retainDiscontent(),this.lastDay=Math.floor(this.collision.brokenDay*1.5)),this.woman.save(),this.man.save(),this.currentDay++}simulateLife(){for(;this.currentDay<this.lastDay;)this.simulateDay()}}class x{constructor(t,e){r(this,"bound","none");r(this,"startDay",0);r(this,"brokenBy",null);r(this,"brokenDay",null);this.man=t,this.woman=e}handleLower(t){this.woman.value>-this.man.value&&this.stop(t)<=2&&this.man.retainCapacity()}handleNone(t){this.woman.value>=this.man.value&&(this.start(t,"upper"),this.woman.addDiscontent()),this.woman.value>0&&this.man.resetDiscontent(),this.woman.value<=-this.man.value&&(this.start(t,"lower"),this.man.looseCapacity(),this.man.addDiscontent(),this.woman.resetDiscontent())}handlePersistentNeglect(){this.woman.value<-this.man.capacity/2&&this.man.isRageFromDiscontent()?this.man.looseCapacity():this.man.addDiscontent()}handleUpper(t){this.woman.value<this.man.value&&this.stop(t)>=2&&this.woman.hate()}shouldCollide(t){return t>this.man.decayDuration&&t>this.woman.decayDuration}start(t,e){this.bound=e,this.startDay=t}stop(t){const e=t-this.startDay;return this.bound="none",this.startDay=0,e}check(t){if(this.shouldCollide(t))switch(this.handlePersistentNeglect(),this.bound){case"none":this.handleNone(t);break;case"upper":this.handleUpper(t);break;case"lower":this.handleLower(t);break}}checkBreakup(t){if(this.brokenDay!=null)return;const e=this.man.value<Math.floor(this.man.capacity/3);(this.woman.value<-this.man.capacity*.8||e)&&(this.brokenDay=t,this.brokenBy=e?"man":"woman")}}class w{constructor(t,e){r(this,"decayDuration");r(this,"decayStep");r(this,"discontent",0);r(this,"history",[]);this.value=t;const[s,a]=e;this.decayDuration=Math.floor(Math.random()*(a-s)+s),this.decayStep=50/this.decayDuration}addDiscontent(){this.discontent++}hate(){this.discontent+=10}isRageFromDiscontent(){const t=Math.min(this.discontent*5,50);return Math.random()*100<=t}save(){this.history.push(this.value)}resetDiscontent(){this.discontent=0}retainDiscontent(){}}class E extends w{constructor(e,s,a){super(e,s);r(this,"bigEmotionDay",30);r(this,"smallEmotionDay",14);r(this,"amplitude",50);this.value=e,this.initialManCapacity=a}emote(e){this.value+=e}getEmotionAmplitude(){return this.amplitude*(1+this.discontent*.05)}addDiscontent(){super.addDiscontent(),this.emote(-(Math.random()*10+10))}changeEmotions(e){if(e>this.decayDuration){const s=this.getEmotionAmplitude();e%this.bigEmotionDay===0?this.emote((Math.random()-.5)*s):(e%this.smallEmotionDay===0||this.isRageFromDiscontent())&&this.emote((Math.random()-.5)*(s/2)),this.value=Math.max(-this.initialManCapacity,Math.min(this.initialManCapacity,this.value))}}decay(e){if(e<=this.decayDuration){const s=(Math.random()-.5)*this.decayStep*5,a=Math.random()<.9?-1:1;this.value+=a*(this.decayStep+s)}}retainDiscontent(){this.discontent>0&&(this.discontent-=this.discontent*.9)}}class P extends w{constructor(e,s){super(e,s);r(this,"resilience",0);r(this,"rancor",.9);this.capacity=e}decay(e){if(e<=this.decayDuration){const s=e/this.decayDuration;this.value=this.capacity-s**2*(this.capacity-100)}}looseCapacity(){this.resilience++,this.value*=this.rancor}retainCapacity(){this.value*=1+.03*this.resilience}retainDiscontent(){this.discontent>0&&(this.discontent-=this.discontent*.5)}}class B{constructor(t){r(this,"ctx");r(this,"logicalHeight");r(this,"logicalWidth");this.logicalWidth=t.width,this.logicalHeight=t.height,this.ctx=t.getContext("2d"),this.adaptCanvasToContainer(t)}adaptCanvasToContainer(t){const e=window.devicePixelRatio||1,s=()=>{const i=t.getBoundingClientRect(),h=Math.floor(i.width*e),n=Math.floor(i.height*e);(t.width!==h||t.height!==n)&&(t.width=h,t.height=n,this.logicalWidth=i.width,this.logicalHeight=i.height,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(e,e))};new ResizeObserver(s).observe(t),s()}mapY(t){return this.logicalHeight/2-t}draw(t,e,s,a,i,h){const{ctx:n}=this;n.clearRect(0,0,this.logicalWidth,this.logicalHeight);const l=o=>(o-i)/h*this.logicalWidth;n.strokeStyle="#888",n.beginPath(),n.moveTo(0,this.mapY(0)),n.lineTo(this.logicalWidth,this.mapY(0)),n.stroke();const u=Math.max(i,0),p=s.brokenDay!=null&&s.brokenDay<a?s.brokenDay:Math.min(a,i+h);n.fillStyle="rgba(100, 149, 237, 0.15)",n.beginPath(),n.moveTo(l(u),this.mapY(t.history[u]));for(let o=u;o<p;o++)n.lineTo(l(o),this.mapY(t.history[o]));for(let o=p-1;o>=u;o--)n.lineTo(l(o),this.mapY(-t.history[o]));if(n.closePath(),n.fill(),s.brokenDay!=null){const o=Math.max(i,s.brokenDay);n.fillStyle="rgba(160, 160, 160, 0.15)",n.beginPath(),n.moveTo(l(o),this.mapY(t.history[s.brokenDay]));for(let c=o;c<a;c++)n.lineTo(l(c),this.mapY(t.history[c]));for(let c=a-1;c>=o;c--)n.lineTo(l(c),this.mapY(-t.history[c]));n.closePath(),n.fill()}const m=Math.max(i,0);n.beginPath(),n.strokeStyle="#ff4f8b",n.moveTo(l(m),this.mapY(e.history[0])),i&&n.moveTo(l(m),this.mapY(e.history[i]));for(let o=m;o<a&&!(s.brokenDay!=null&&o>=s.brokenDay);o++)n.lineTo(l(o),this.mapY(e.history[o]));if(n.stroke(),s.brokenDay!=null&&a>s.brokenDay){n.beginPath(),n.strokeStyle="#aaa";let o=e.history[s.brokenDay],c=!1,f=0;n.moveTo(l(s.brokenDay),this.mapY(o));for(let y=s.brokenDay;y<a;y++){const g=e.history[y];c?n.lineTo(l(y),this.mapY(f)):((g===0||g*o<0)&&(c=!0,f=g),n.lineTo(l(y),this.mapY(g)),o=g)}n.stroke()}if(s.brokenDay!=null&&a>=s.brokenDay){const o=l(s.brokenDay),c=this.mapY(s.brokenBy==="man"?-t.history[s.brokenDay]:e.history[s.brokenDay]);n.fillStyle="#000",n.font="24px sans-serif",n.textAlign="center",n.fillText("✂️",o,this.mapY(-10)),n.beginPath(),n.moveTo(o,this.mapY(0)),n.lineTo(o,c),n.strokeStyle="#000",n.stroke();const f=s.brokenBy==="man"?"♂️":"♀️";n.fillText(f,o,c)}}}class S{constructor(t){r(this,"ctx");r(this,"currentSpacing",0);r(this,"logicalHeight");r(this,"logicalWidth");this.logicalWidth=t.width,this.logicalHeight=t.height,this.ctx=t.getContext("2d"),this.adaptCanvasToContainer(t)}adaptCanvasToContainer(t){const e=window.devicePixelRatio||1,s=()=>{const i=t.getBoundingClientRect(),h=Math.floor(i.width*e),n=Math.floor(i.height*e);(t.width!==h||t.height!==n)&&(t.width=h,t.height=n,this.logicalWidth=i.width,this.logicalHeight=i.height,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(e,e))};new ResizeObserver(s).observe(t),s()}drawCharacter(t,e,s,a){const i=this.ctx;i.save(),i.strokeStyle=a,i.fillStyle=a,i.lineWidth=2,i.beginPath(),i.moveTo(t,e+40),i.lineTo(t,e+80),i.stroke(),i.beginPath(),i.moveTo(t-15,e+55),i.lineTo(t+15,e+55),i.stroke(),i.beginPath(),i.moveTo(t,e+80),i.lineTo(t-10,e+100),i.moveTo(t,e+80),i.lineTo(t+10,e+100),i.stroke(),i.font="42px serif",i.textAlign="center",i.fillText(s,t,e+40),i.restore()}getEmoji(t,e,s){return e.brokenDay&&s>=e.brokenDay?"💀":t.discontent>20?"😭":t.discontent>10?"😡":t.discontent>5?"😕":t.value>140?"😍":t.value>80?"😊":t.value<60?"🥺":"😐"}draw(t,e,s,a){const i=Math.max(0,Math.min(a,t.history.length-1,e.history.length-1));this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight);const n=Math.abs(e.history[i]-t.history[i])*2,l=this.logicalWidth/2,u=.1;this.currentSpacing+=(n-this.currentSpacing)*u;const p=l-this.currentSpacing/2,m=l+this.currentSpacing/2,o=40;this.drawCharacter(p,o,this.getEmoji(t,s,i),"#4682B4"),this.drawCharacter(m,o,this.getEmoji(e,s,i),"#FF69B4")}}class Y{constructor(t,e,s,a,i=10,h){r(this,"currentDay",0);r(this,"frameId",null);r(this,"isPlaying",!1);r(this,"lastTickTime",0);r(this,"graph");r(this,"scene");r(this,"timeline");if(this.man=t,this.woman=e,this.collision=s,this.totalDays=a,this.speed=i,this.frameDays=h,window.addEventListener("resize",()=>this.handleOrientationChange(),{once:!1}),this.isMobile()){const n=document.getElementById("player-controls");n&&(n.style.display="none")}this.handleOrientationChange(),this.graph=new B(document.getElementById("graph")),this.scene=new S(document.getElementById("scene")),this.timeline=document.getElementById("timeline"),document.getElementById("play").onclick=()=>this.play(),document.getElementById("pause").onclick=()=>this.pause(),document.getElementById("rewind").onclick=()=>this.rewind(30),document.getElementById("forward").onclick=()=>this.forward(30),this.setupCanvasDrag(document.getElementById("graph")),this.timeline.max=String(a),this.timeline.oninput=()=>this.seek(Number(this.timeline.value))}setupCanvasDrag(t){let e=!1,s=0;const a=t.clientWidth/this.frameDays,i=h=>{const n=h-s;s=h;const l=Math.round(n/a);this.seek(this.currentDay-l)};t.addEventListener("mousedown",h=>{e=!0,s=h.clientX}),window.addEventListener("mousemove",h=>{e&&i(h.clientX)}),window.addEventListener("mouseup",()=>{e=!1}),t.addEventListener("touchstart",h=>{h.touches.length===1&&(e=!0,s=h.touches[0].clientX)},{passive:!0}),window.addEventListener("touchmove",h=>{!e||h.touches.length!==1||(h.preventDefault(),i(h.touches[0].clientX))},{passive:!1}),window.addEventListener("touchend",()=>{e=!1})}updateFrame(){const t=Math.max(0,this.currentDay-this.frameDays);this.graph.draw(this.man,this.woman,this.collision,this.currentDay,t,this.frameDays),this.scene.draw(this.man,this.woman,this.collision,this.currentDay-1),this.timeline.value=String(this.currentDay),this.currentDay++}play(){this.isPlaying||(this.isPlaying=!0,this.frameId=requestAnimationFrame(t=>this.tick(t)))}pause(){this.frameId&&cancelAnimationFrame(this.frameId),this.isPlaying=!1}stop(){this.pause(),this.currentDay=0,this.frameId=null,this.lastTickTime=0}forward(t=10){this.pause(),this.currentDay=Math.min(this.totalDays,this.currentDay+t),this.updateFrame()}rewind(t=10){this.pause(),this.currentDay=Math.max(0,this.currentDay-t),this.updateFrame()}seek(t){this.pause(),this.currentDay=Math.max(0,Math.min(this.totalDays,t)),this.updateFrame()}tick(t=0){this.currentDay<=this.totalDays?(t-this.lastTickTime>=this.speed&&(this.updateFrame(),this.lastTickTime=t),this.frameId=requestAnimationFrame(e=>this.tick(e))):this.stop()}isMobile(){return/Mobi|Android|iPhone/i.test(navigator.userAgent)}isPortrait(){return window.innerHeight>window.innerWidth}handleOrientationChange(){this.isMobile()&&(this.isPortrait()?(this.pause(),this.showRotateMessage()):(this.hideRotateMessage(),this.play()))}showRotateMessage(){const t=document.getElementById("message");t&&(t.style.display="flex")}hideRotateMessage(){const t=document.getElementById("message");t&&(t.style.display="none")}}const D=new P(150,[14,90]),b=new E(150,[14,90],D.value),k=new x(D,b),I=100*365,v=new C(D,b,k,I);v.simulateLife();const R=new Y(D,b,k,v.lastDay,10,365);R.play();
