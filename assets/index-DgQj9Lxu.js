var v=Object.defineProperty;var M=(c,t,e)=>t in c?v(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var n=(c,t,e)=>M(c,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class T{constructor(t,e,s,i){n(this,"currentDay",0);n(this,"lastDay");this.man=t,this.woman=e,this.collision=s,this.lastDay=i}simulateDay(){this.woman.decay(this.currentDay),this.man.decay(this.currentDay),this.woman.changeEmotions(this.currentDay),this.collision.check(this.currentDay),this.collision.checkBreakup(this.currentDay),this.collision.brakeUpDay&&(this.man.retainDiscontent(),this.woman.retainDiscontent(),this.lastDay=Math.floor(this.collision.brakeUpDay*1.5)),this.woman.save(),this.man.save(),this.currentDay++}simulateLife(){for(;this.currentDay<this.lastDay;)this.simulateDay()}}class S{constructor(t,e){n(this,"bound","none");n(this,"startDay",0);n(this,"brokeUp",null);n(this,"brakeUpDay",null);this.man=t,this.woman=e}handleLower(t){this.woman.value>-this.man.value&&this.stop(t)<=2&&this.man.retainCapacity()}handleNone(t){this.woman.value>=this.man.value&&(this.start(t,"upper"),this.woman.addDiscontent()),this.woman.value>0&&this.man.resetDiscontent(),this.woman.value<=-this.man.value&&(this.start(t,"lower"),this.man.looseCapacity(),this.man.addDiscontent(),this.woman.resetDiscontent())}handlePersistentNeglect(){this.woman.value<-this.man.capacity/3&&this.man.isRageFromDiscontent()?this.man.looseCapacity():this.man.addDiscontent()}handleUpper(t){this.woman.value<this.man.value&&this.stop(t)>=2&&this.woman.hate()}shouldCollide(t){return t>this.man.decayDuration&&t>this.woman.decayDuration}start(t,e){this.bound=e,this.startDay=t}stop(t){const e=t-this.startDay;return this.bound="none",this.startDay=0,e}check(t){if(this.shouldCollide(t))switch(this.handlePersistentNeglect(),this.bound){case"none":this.handleNone(t);break;case"upper":this.handleUpper(t);break;case"lower":this.handleLower(t);break}}checkBreakup(t){if(this.brakeUpDay!=null)return;const e=this.man.value<Math.floor(this.man.capacity/3);(this.woman.value<-this.man.capacity*.8||e)&&(this.brakeUpDay=t,this.brokeUp=e?"man":"woman")}}class D{constructor(t,e){n(this,"decayDuration");n(this,"decayStep");n(this,"discontent",0);n(this,"history",[]);this.value=t;const[s,i]=e;this.decayDuration=Math.floor(Math.random()*(i-s)+s),this.decayStep=50/this.decayDuration}addDiscontent(){this.discontent++}hate(){this.discontent+=10}isRageFromDiscontent(){const t=Math.min(this.discontent*5,50);return Math.random()*100<=t}save(){this.history.push(this.value)}resetDiscontent(){this.discontent=0}retainDiscontent(){}}class U extends D{constructor(e,s,i){super(e,s);n(this,"bigEmotionDay",30);n(this,"smallEmotionDay",14);n(this,"amplitude",50);this.value=e,this.initialManCapacity=i}emote(e){this.value+=e}getEmotionAmplitude(){return this.amplitude*(1+this.discontent*.05)}addDiscontent(){super.addDiscontent(),this.emote(-(Math.random()*10+10))}changeEmotions(e){if(e>this.decayDuration){const s=this.getEmotionAmplitude();e%this.bigEmotionDay===0?this.emote((Math.random()-.5)*s):(e%this.smallEmotionDay===0||this.isRageFromDiscontent())&&this.emote((Math.random()-.5)*(s/2)),this.value=Math.max(-this.initialManCapacity,Math.min(this.initialManCapacity,this.value))}}decay(e){if(e<=this.decayDuration){const s=(Math.random()-.5)*this.decayStep*5,i=Math.random()<.9?-1:1;this.value+=i*(this.decayStep+s)}}retainDiscontent(){this.discontent>0&&(this.discontent-=this.discontent*.9)}}class C extends D{constructor(e,s){super(e,s);n(this,"resilience",0);n(this,"rancor",.9);this.capacity=e}decay(e){if(e<=this.decayDuration){const s=e/this.decayDuration;this.value=this.capacity-s**2*(this.capacity-100)}}looseCapacity(){this.resilience++,this.value*=this.rancor}retainCapacity(){this.value*=1+.03*this.resilience}retainDiscontent(){this.discontent>0&&(this.discontent-=this.discontent*.5)}}class x{constructor(t){n(this,"ctx");n(this,"logicalHeight",0);n(this,"logicalWidth",0);n(this,"scale",1);n(this,"mapX",t=>t);this.canvas=t,this.ctx=t.getContext("2d"),this.adaptCanvasToContainer(t)}adaptCanvasToContainer(t){this.resize=this.resize.bind(this),this.resize(),new ResizeObserver(this.resize).observe(t)}resize(){const t=window.devicePixelRatio||1,e=this.canvas.getBoundingClientRect(),s=Math.floor(e.width*t),i=Math.floor(e.height*t);(this.canvas.width!==s||this.canvas.height!==i)&&(this.canvas.width=s,this.canvas.height=i,this.logicalWidth=e.width,this.logicalHeight=e.height,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(t,t))}mapY(t){return this.logicalHeight/2-t*this.scale}drawCanvas(t,e,s){this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight),this.mapX=i=>(i-t)/e*this.logicalWidth,this.scale=this.logicalHeight/2*.8/s,this.ctx.lineWidth=2*this.scale}}class P extends x{constructor(t){super(t)}drawAxis(){this.ctx.strokeStyle="#888",this.ctx.beginPath(),this.ctx.moveTo(0,this.mapY(0)),this.ctx.lineTo(this.logicalWidth,this.mapY(0)),this.ctx.stroke()}drawBlueTunnel(t,e,s){this.ctx.fillStyle="rgba(100, 149, 237, 0.2)",this.ctx.beginPath(),this.ctx.moveTo(this.mapX(e),this.mapY(t[e]));for(let i=e;i<=s;i++)this.ctx.lineTo(this.mapX(i),this.mapY(t[i]));for(let i=s;i>=e;i--)this.ctx.lineTo(this.mapX(i),this.mapY(-t[i]));this.ctx.closePath(),this.ctx.fill()}drawGrayTunnel(t,e,s){this.ctx.fillStyle="rgba(160, 160, 160, 0.2)",this.ctx.beginPath(),this.ctx.moveTo(this.mapX(e),this.mapY(t[e]));for(let i=e;i<=s;i++)this.ctx.lineTo(this.mapX(i),this.mapY(t[i]));for(let i=s;i>=e;i--)this.ctx.lineTo(this.mapX(i),this.mapY(-t[i]));this.ctx.closePath(),this.ctx.fill()}drawTunnel(t,e,s,i,a){const h=Math.max(i,0),o=e.brakeUpDay!=null&&e.brakeUpDay<s?e.brakeUpDay:Math.min(s,i+a);if(this.drawBlueTunnel(t,h,o),e.brakeUpDay!=null){const r=Math.max(i,e.brakeUpDay);this.drawGrayTunnel(t,r,s)}}drawRedLine(t,e,s){this.ctx.beginPath(),this.ctx.strokeStyle="#ff4f8b",this.ctx.moveTo(this.mapX(e),this.mapY(t[e])),e&&this.ctx.moveTo(this.mapX(e),this.mapY(t[e]));for(let i=e;i<=s;i++)this.ctx.lineTo(this.mapX(i),this.mapY(t[i]));this.ctx.stroke()}drawGrayLine(t,e,s){this.ctx.beginPath(),this.ctx.strokeStyle="#aaa";let i=0,a=t[e],h=!1;this.ctx.moveTo(this.mapX(e),this.mapY(a));for(let o=e;o<s;o++){const r=t[o];h?this.ctx.lineTo(this.mapX(o),this.mapY(i)):((r===0||r*a<0)&&(h=!0,i=r),this.ctx.lineTo(this.mapX(o),this.mapY(r)),a=r)}this.ctx.stroke()}drawWomanLine(t,e,s,i,a){const h=Math.max(i,0),o=e.brakeUpDay!=null&&e.brakeUpDay<s?e.brakeUpDay:Math.min(s,i+a);this.drawRedLine(t,h,o),e.brakeUpDay!=null&&s>e.brakeUpDay&&this.drawGrayLine(t,o,s)}drawMarker(t,e,s){const i=this.mapX(t),a=this.mapY(e);this.ctx.save(),this.ctx.fillStyle="#000",this.ctx.font="24px sans-serif",this.ctx.textAlign="center",this.ctx.fillText("‚úÇÔ∏è",i,this.mapY(-10)),this.ctx.beginPath(),this.ctx.moveTo(i,this.mapY(0)),this.ctx.lineTo(i,a),this.ctx.strokeStyle="#000",this.ctx.stroke(),this.ctx.fillText(s,i,a),this.ctx.restore()}drawBreakup(t,e,s,i){if(s.brakeUpDay!=null&&i>=s.brakeUpDay){const a=s.brokeUp==="man",h=a?-t[s.brakeUpDay]:e[s.brakeUpDay],o=a?"‚ôÇÔ∏è":"‚ôÄÔ∏è";this.drawMarker(s.brakeUpDay,h,o)}}draw(t,e,s,i,a,h,o){this.drawCanvas(a,h,o),this.drawAxis(),this.drawTunnel(t,s,i,a,h),this.drawWomanLine(e,s,i,a,h),this.drawBreakup(t,e,s,i)}}class B extends x{constructor(e){super(e);n(this,"currentSpacing",0)}drawCharacter(e,s,i){const r=this.logicalHeight/2-50*this.scale;this.ctx.save(),this.ctx.strokeStyle=i,this.ctx.fillStyle=i,this.ctx.lineWidth=8,this.ctx.beginPath(),this.ctx.moveTo(e,r),this.ctx.lineTo(e,r+40),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e-20,r+40/2),this.ctx.lineTo(e+20,r+40/2),this.ctx.stroke();const l=r+40;this.ctx.beginPath(),this.ctx.moveTo(e,l),this.ctx.lineTo(e-20,l+20),this.ctx.moveTo(e,l),this.ctx.lineTo(e+20,l+20),this.ctx.stroke(),this.ctx.font="42px serif",this.ctx.textAlign="center",this.ctx.fillText(s,e,r+5),this.ctx.restore()}getEmoji(e,s,i){return s.brakeUpDay&&i>=s.brakeUpDay?"üòê":i<e.decayDuration||e.history[i]>100?"üòç":e.history[i]>80?"üòä":e.history[i]<60?"ü•∫":e.history[i]<0?"üò°":e.discontent>20?"üò≠":e.discontent>10?"üò°":e.discontent>5?"üòï":"üòê"}draw(e,s,i,a,h,o){this.drawCanvas(0,h,o);const r=Math.max(0,Math.min(a,e.history.length-1,s.history.length-1));this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight);const l=this.logicalWidth*.8,g=Math.abs(s.history[r]-e.history[r])*2,d=Math.min(g,l),p=this.logicalWidth/2,m=.1;this.currentSpacing+=(d-this.currentSpacing)*m;const u=p-this.currentSpacing/2,k=p+this.currentSpacing/2;this.drawCharacter(u,this.getEmoji(e,i,r),"#4682B4"),this.drawCharacter(k,this.getEmoji(s,i,r),"#FF69B4")}}class E{constructor(){n(this,"currentDay");n(this,"brakeUpDay");n(this,"brokeUp");this.currentDay=document.getElementById("current-day"),this.brokeUp=document.getElementById("broke-up"),this.brakeUpDay=document.getElementById("brake-up-day")}formatDuration(t){const e=Math.floor(t/365),s=Math.floor(t%365/30),i=Math.floor(t%30);return`${e.toString().padStart(2,"0")}y ${s.toString().padStart(2,"0")}m ${i.toString().padStart(2,"0")}d`}updateCurrentDay(t){this.currentDay.textContent=typeof t=="number"?this.formatDuration(t):t}updateBrakeUpDay(t){this.brakeUpDay.textContent=typeof t=="number"?this.formatDuration(t):t}updateBrokeUp(t){this.brokeUp.textContent=typeof t=="number"?this.formatDuration(t):t}}class L{constructor(){n(this,"newAtMaxButton");n(this,"newAtMax");n(this,"down");n(this,"up");this.up=document.getElementById("speed-up"),this.down=document.getElementById("speed-down"),this.newAtMax=document.getElementById("new-at-max"),this.newAtMaxButton=document.getElementById("new-at-max-button"),this.newAtMaxButton.onclick=()=>window.location.reload()}updateNewAtMax(t){this.newAtMax.textContent=t.toString()}}class I{constructor(t,e,s,i,a,h){n(this,"currentDay",0);n(this,"frameId",null);n(this,"graph");n(this,"isPlaying",!1);n(this,"lastTickTime",performance.now());n(this,"scene");n(this,"timeline");n(this,"info",new E);n(this,"controls",new L);n(this,"refreshRate",60);this.man=t,this.woman=e,this.collision=s,this.totalDays=i,this.daysPerSecond=a,this.frameDays=h,this.estimateRefreshRate(r=>{this.refreshRate=r,console.log("Estimated refresh rate:",r,"Hz")});const o=Number(window.localStorage.getItem("daysPerSecond"));o?this.daysPerSecond=o:this.daysPerSecond=a,this.tick=this.tick.bind(this),this.graph=new P(document.getElementById("graph")),this.scene=new B(document.getElementById("scene")),this.timeline=document.getElementById("timeline"),this.controls.up.onclick=()=>this.updateSpeed(10),this.controls.down.onclick=()=>this.updateSpeed(-10),this.setupCanvasDrag(document.getElementById("graph")),this.timeline.max=String(i),this.timeline.oninput=()=>{this.seek(Number(this.timeline.value))}}estimateRefreshRate(t,e=60,s=[60,120,144,165,240]){const i=[];let a=performance.now();function h(o){const r=o-a;if(a=o,i.push(r),i.length<e)requestAnimationFrame(h);else{const l=i.filter(m=>m>5&&m<100),d=1e3/(l.reduce((m,u)=>m+u,0)/l.length),p=s.reduce((m,u)=>Math.abs(u-d)<Math.abs(m-d)?u:m);t(p)}}requestAnimationFrame(h)}updateSpeed(t){const e=Math.max(0,this.daysPerSecond+t);this.daysPerSecond=e,window.localStorage.setItem("daysPerSecond",String(e))}setupCanvasDrag(t){let e=!1,s=0;const i=a=>{const h=a-s;s=a;const o=Math.max(1,this.frameDays),r=t.clientWidth/o,l=Math.round(h/r);this.seek(this.currentDay-l)};t.addEventListener("mousedown",a=>{e=!0,s=a.clientX,this.pause()}),window.addEventListener("mousemove",a=>{e&&i(a.clientX)}),window.addEventListener("mouseup",()=>{e=!1,this.play()}),t.addEventListener("touchstart",a=>{a.touches.length===1&&(e=!0,s=a.touches[0].clientX,this.pause())},{passive:!0}),window.addEventListener("touchmove",a=>{!e||a.touches.length!==1||(a.preventDefault(),i(a.touches[0].clientX))},{passive:!1}),window.addEventListener("touchend",()=>{e=!1,this.play()})}updateFrame(t){const e=Math.max(0,t-this.frameDays);this.graph.draw(this.man.history,this.woman.history,this.collision,Math.floor(t),Math.floor(e),this.frameDays,this.man.capacity),this.scene.draw(this.man,this.woman,this.collision,Math.floor(t)-1,this.frameDays,this.man.capacity),this.timeline.value=String(t),this.updateViews(t)}updateViews(t){this.info.updateCurrentDay(t);const e=this.collision.brakeUpDay&&t>=this.collision.brakeUpDay;this.info.updateBrokeUp(e?this.collision.brokeUp:"not yet"),this.info.updateBrakeUpDay(e?this.collision.brakeUpDay:"not yet"),this.controls.updateNewAtMax(this.daysPerSecond)}play(){this.isPlaying||(this.isPlaying=!0,this.lastTickTime=performance.now(),this.frameId=requestAnimationFrame(t=>this.tick(t)))}pause(){this.frameId&&cancelAnimationFrame(this.frameId),this.isPlaying=!1}stop(){this.pause(),this.currentDay=0,this.frameId=null,this.lastTickTime=performance.now()}forward(t=10){this.pause(),this.currentDay=Math.min(this.totalDays,this.currentDay+t),this.lastTickTime=performance.now(),this.updateFrame(this.currentDay)}rewind(t=10){this.pause(),this.currentDay=Math.max(0,this.currentDay-t),this.lastTickTime=performance.now(),this.updateFrame(this.currentDay)}seek(t){this.pause();const e=Math.max(0,Math.min(this.totalDays,t));this.currentDay=e,this.lastTickTime=performance.now(),this.updateFrame(this.currentDay)}tick(t){if(!this.isPlaying)return;const e=(t-this.lastTickTime)/1e3;if(e<1/this.refreshRate){this.frameId=requestAnimationFrame(this.tick);return}if(this.lastTickTime=t,this.currentDay+=e*this.daysPerSecond,this.currentDay>=this.totalDays){this.currentDay=this.totalDays,this.updateFrame(this.currentDay),this.pause();return}this.updateFrame(this.currentDay),this.frameId=requestAnimationFrame(this.tick)}}const y=new C(150,[14,90]),f=new U(150,[14,90],y.value),w=new S(y,f),A=100*365,b=new T(y,f,w,A);b.simulateLife();const Y=new I(y,f,w,b.lastDay,30,365);Y.play();
