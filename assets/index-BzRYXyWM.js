var v=Object.defineProperty;var k=(o,i,t)=>i in o?v(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t;var h=(o,i,t)=>k(o,typeof i!="symbol"?i+"":i,t);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}})();class b{constructor(i,t,s,e){h(this,"currentDay",0);h(this,"lastDay");this.man=i,this.woman=t,this.collision=s,this.lastDay=e}simulateDay(){this.woman.decay(this.currentDay),this.man.decay(this.currentDay),this.woman.changeEmotions(this.currentDay),this.collision.check(this.currentDay),this.collision.checkBreakup(this.currentDay),this.collision.brokenDay&&(this.man.retainDiscontent(),this.woman.retainDiscontent(),this.lastDay=Math.floor(this.collision.brokenDay*1.5)),this.woman.save(),this.man.save(),this.currentDay++}simulateLife(){for(;this.currentDay<this.lastDay;)this.simulateDay()}}class T{constructor(i,t){h(this,"bound","none");h(this,"startDay",0);h(this,"brokenBy",null);h(this,"brokenDay",null);this.man=i,this.woman=t}handleLower(i){this.woman.value>-this.man.value&&this.stop(i)<=2&&this.man.retainCapacity()}handleNone(i){this.woman.value>=this.man.value&&(this.start(i,"upper"),this.woman.addDiscontent()),this.woman.value>0&&this.man.resetDiscontent(),this.woman.value<=-this.man.value&&(this.start(i,"lower"),this.man.looseCapacity(),this.man.addDiscontent(),this.woman.resetDiscontent())}handlePersistentNeglect(){this.woman.value<-this.man.capacity/2&&this.man.isRageFromDiscontent()?this.man.looseCapacity():this.man.addDiscontent()}handleUpper(i){this.woman.value<this.man.value&&this.stop(i)>=2&&this.woman.hate()}shouldCollide(i){return i>this.man.decayDuration&&i>this.woman.decayDuration}start(i,t){this.bound=t,this.startDay=i}stop(i){const t=i-this.startDay;return this.bound="none",this.startDay=0,t}check(i){if(this.shouldCollide(i))switch(this.handlePersistentNeglect(),this.bound){case"none":this.handleNone(i);break;case"upper":this.handleUpper(i);break;case"lower":this.handleLower(i);break}}checkBreakup(i){if(this.brokenDay!=null)return;const t=this.man.value<Math.floor(this.man.capacity/3);(this.woman.value<-this.man.capacity*.8||t)&&(this.brokenDay=i,this.brokenBy=t?"man":"woman")}}class y{constructor(i,t){h(this,"decayDuration");h(this,"decayStep");h(this,"discontent",0);h(this,"history",[]);this.value=i;const[s,e]=t;this.decayDuration=Math.floor(Math.random()*(e-s)+s),this.decayStep=50/this.decayDuration}addDiscontent(){this.discontent++}hate(){this.discontent+=10}isRageFromDiscontent(){const i=Math.min(this.discontent*5,50);return Math.random()*100<=i}save(){this.history.push(this.value)}resetDiscontent(){this.discontent=0}retainDiscontent(){}}class M extends y{constructor(t,s,e){super(t,s);h(this,"bigEmotionDay",30);h(this,"smallEmotionDay",14);h(this,"amplitude",50);this.value=t,this.initialManCapacity=e}emote(t){this.value+=t}getEmotionAmplitude(){return this.amplitude*(1+this.discontent*.05)}addDiscontent(){super.addDiscontent(),this.emote(-(Math.random()*10+10))}changeEmotions(t){if(t>this.decayDuration){const s=this.getEmotionAmplitude();t%this.bigEmotionDay===0?this.emote((Math.random()-.5)*s):(t%this.smallEmotionDay===0||this.isRageFromDiscontent())&&this.emote((Math.random()-.5)*(s/2)),this.value=Math.max(-this.initialManCapacity,Math.min(this.initialManCapacity,this.value))}}decay(t){if(t<=this.decayDuration){const s=(Math.random()-.5)*this.decayStep*5,e=Math.random()<.9?-1:1;this.value+=e*(this.decayStep+s)}}retainDiscontent(){this.discontent>0&&(this.discontent-=this.discontent*.9)}}class C extends y{constructor(t,s){super(t,s);h(this,"resilience",0);h(this,"rancor",.9);this.capacity=t}decay(t){if(t<=this.decayDuration){const s=t/this.decayDuration;this.value=this.capacity-s**2*(this.capacity-100)}}looseCapacity(){this.resilience++,this.value*=this.rancor}retainCapacity(){this.value*=1+.03*this.resilience}retainDiscontent(){this.discontent>0&&(this.discontent-=this.discontent*.5)}}class p{constructor(i){h(this,"ctx");h(this,"logicalHeight",0);h(this,"logicalWidth",0);h(this,"scale",1);h(this,"mapX",i=>i);this.canvas=i,this.ctx=i.getContext("2d"),this.adaptCanvasToContainer(i)}adaptCanvasToContainer(i){this.resize(),new ResizeObserver(this.resize).observe(i)}resize(){const i=window.devicePixelRatio||1,t=this.canvas.getBoundingClientRect(),s=Math.floor(t.width*i),e=Math.floor(t.height*i);(this.canvas.width!==s||this.canvas.height!==e)&&(this.canvas.width=s,this.canvas.height=e,this.logicalWidth=t.width,this.logicalHeight=t.height,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(i,i))}mapY(i){return this.logicalHeight/2-i}drawCanvas(i,t){this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight),this.mapX=s=>(s-i)/t*this.logicalWidth,this.scale=this.logicalHeight/this.canvas.height,this.ctx.lineWidth=1*this.scale}}class P extends p{constructor(i){super(i)}drawAxis(){this.ctx.strokeStyle="#888",this.ctx.beginPath(),this.ctx.moveTo(0,this.mapY(0)),this.ctx.lineTo(this.logicalWidth,this.mapY(0)),this.ctx.stroke()}drawBlueTunnel(i,t,s){this.ctx.fillStyle="rgba(100, 149, 237, 0.15)",this.ctx.beginPath(),this.ctx.moveTo(this.mapX(t),this.mapY(i[t]));for(let e=t;e<s;e++)this.ctx.lineTo(this.mapX(e),this.mapY(i[e]));for(let e=s-1;e>=t;e--)this.ctx.lineTo(this.mapX(e),this.mapY(-i[e]));this.ctx.closePath(),this.ctx.fill()}drawGrayTunnel(i,t,s){this.ctx.fillStyle="rgba(160, 160, 160, 0.15)",this.ctx.beginPath(),this.ctx.moveTo(this.mapX(t),this.mapY(i[t]));for(let e=t;e<s;e++)this.ctx.lineTo(this.mapX(e),this.mapY(i[e]));for(let e=s-1;e>=t;e--)this.ctx.lineTo(this.mapX(e),this.mapY(-i[e]));this.ctx.closePath(),this.ctx.fill()}drawTunnel(i,t,s,e,n){const a=Math.max(e,0),r=t.brokenDay!=null&&t.brokenDay<s?t.brokenDay:Math.min(s,e+n);if(this.drawBlueTunnel(i,a,r),t.brokenDay!=null){const c=Math.max(e,t.brokenDay);this.drawGrayTunnel(i,c,s)}}drawRedLine(i,t,s){this.ctx.beginPath(),this.ctx.strokeStyle="#ff4f8b",this.ctx.moveTo(this.mapX(t),this.mapY(i[0])),t&&this.ctx.moveTo(this.mapX(t),this.mapY(i[t]));for(let e=t;e<s;e++)this.ctx.lineTo(this.mapX(e),this.mapY(i[e]));this.ctx.stroke()}drawGrayLine(i,t,s){this.ctx.beginPath(),this.ctx.strokeStyle="#aaa";let e=0,n=i[t],a=!1;this.ctx.moveTo(this.mapX(t),this.mapY(n));for(let r=t;r<s;r++){const c=i[r];a?this.ctx.lineTo(this.mapX(r),this.mapY(e)):((c===0||c*n<0)&&(a=!0,e=c),this.ctx.lineTo(this.mapX(r),this.mapY(c)),n=c)}this.ctx.stroke()}drawWomanLine(i,t,s,e,n){const a=Math.max(e,0),r=t.brokenDay!=null&&t.brokenDay<s?t.brokenDay:Math.min(s,e+n);this.drawRedLine(i,a,r),t.brokenDay!=null&&s>t.brokenDay&&this.drawGrayLine(i,r,s)}drawMarker(i,t,s){const e=this.mapX(i),n=this.mapY(t);this.ctx.fillStyle="#000",this.ctx.font="24px sans-serif",this.ctx.textAlign="center",this.ctx.fillText("✂️",e,this.mapY(-10)),this.ctx.beginPath(),this.ctx.moveTo(e,this.mapY(0)),this.ctx.lineTo(e,n),this.ctx.strokeStyle="#000",this.ctx.stroke(),this.ctx.fillText(s,e,n)}drawBreakup(i,t,s,e){if(s.brokenDay!=null&&e>=s.brokenDay){const n=s.brokenBy==="man",a=n?-i[s.brokenDay]:t[s.brokenDay],r=n?"♂️":"♀️";this.drawMarker(s.brokenDay,a,r)}}draw(i,t,s,e,n,a){this.drawCanvas(n,a),this.drawAxis(),this.drawTunnel(i,s,e,n,a),this.drawWomanLine(t,s,e,n,a),this.drawBreakup(i,t,s,e)}}class E extends p{constructor(t){super(t);h(this,"currentSpacing",0)}drawCharacter(t,s,e,n){const a=s*this.scale;this.ctx.save(),this.ctx.strokeStyle=n,this.ctx.fillStyle=n,this.ctx.lineWidth=20*this.scale,this.ctx.beginPath(),this.ctx.moveTo(t,a+40),this.ctx.lineTo(t,a+80),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t-15,a+55),this.ctx.lineTo(t+15,a+55),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t,a+80),this.ctx.lineTo(t-10,a+100),this.ctx.moveTo(t,a+80),this.ctx.lineTo(t+10,a+100),this.ctx.stroke(),this.ctx.font="42px serif",this.ctx.textAlign="center",this.ctx.fillText(e,t,a+40),this.ctx.restore()}getEmoji(t,s,e){return s.brokenDay&&e>=s.brokenDay?"💀":t.discontent>20?"😭":t.discontent>10?"😡":t.discontent>5?"😕":t.value>140?"😍":t.value>80?"😊":t.value<60?"🥺":"😐"}draw(t,s,e,n,a){this.drawCanvas(0,a);const r=Math.max(0,Math.min(n,t.history.length-1,s.history.length-1));this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight);const c=Math.abs(s.history[r]-t.history[r])*2,m=this.logicalWidth/2,g=.1;this.currentSpacing+=(c-this.currentSpacing)*g;const x=m-this.currentSpacing/2,w=m+this.currentSpacing/2,d=this.logicalHeight/2;this.drawCharacter(x,d,this.getEmoji(t,e,r),"#4682B4"),this.drawCharacter(w,d,this.getEmoji(s,e,r),"#FF69B4")}}class X{constructor(i,t,s,e,n=10,a){h(this,"currentDay",0);h(this,"frameId",null);h(this,"isPlaying",!1);h(this,"lastTickTime",0);h(this,"graph");h(this,"scene");h(this,"timeline");this.man=i,this.woman=t,this.collision=s,this.totalDays=e,this.speed=n,this.frameDays=a,this.graph=new P(document.getElementById("graph")),this.scene=new E(document.getElementById("scene")),this.timeline=document.getElementById("timeline"),this.setupCanvasDrag(document.getElementById("graph")),this.timeline.max=String(e),this.timeline.oninput=()=>this.seek(Number(this.timeline.value))}setupCanvasDrag(i){let t=!1,s=0;const e=i.clientWidth/this.frameDays,n=a=>{const r=a-s;s=a;const c=Math.round(r/e);this.seek(this.currentDay-c)};i.addEventListener("mousedown",a=>{t=!0,s=a.clientX}),window.addEventListener("mousemove",a=>{t&&n(a.clientX)}),window.addEventListener("mouseup",()=>{t=!1}),i.addEventListener("touchstart",a=>{a.touches.length===1&&(t=!0,s=a.touches[0].clientX)},{passive:!0}),window.addEventListener("touchmove",a=>{!t||a.touches.length!==1||(a.preventDefault(),n(a.touches[0].clientX))},{passive:!1}),window.addEventListener("touchend",()=>{t=!1})}updateFrame(){const i=Math.max(0,this.currentDay-this.frameDays);this.graph.draw(this.man.history,this.woman.history,this.collision,this.currentDay,i,this.frameDays),this.scene.draw(this.man,this.woman,this.collision,this.currentDay-1,this.frameDays),this.timeline.value=String(this.currentDay),this.currentDay++}play(){this.isPlaying||(this.isPlaying=!0,this.frameId=requestAnimationFrame(i=>this.tick(i)))}pause(){this.frameId&&cancelAnimationFrame(this.frameId),this.isPlaying=!1}stop(){this.pause(),this.currentDay=0,this.frameId=null,this.lastTickTime=0}forward(i=10){this.pause(),this.currentDay=Math.min(this.totalDays,this.currentDay+i),this.updateFrame()}rewind(i=10){this.pause(),this.currentDay=Math.max(0,this.currentDay-i),this.updateFrame()}seek(i){this.pause(),this.currentDay=Math.max(0,Math.min(this.totalDays,i)),this.updateFrame()}tick(i=0){this.currentDay<=this.totalDays?(i-this.lastTickTime>=this.speed&&(this.updateFrame(),this.lastTickTime=i),this.frameId=requestAnimationFrame(t=>this.tick(t))):this.stop()}}const l=new C(150,[14,90]),u=new M(150,[14,90],l.value),f=new T(l,u),Y=100*365,D=new b(l,u,f,Y);D.simulateLife();const B=new X(l,u,f,D.lastDay,10,365);B.play();
