var k=Object.defineProperty;var T=(c,e,t)=>e in c?k(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var h=(c,e,t)=>T(c,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();class M{constructor(e,t,s,i){h(this,"currentDay",0);h(this,"lastDay");this.man=e,this.woman=t,this.collision=s,this.lastDay=i}simulateDay(){this.woman.decay(this.currentDay),this.man.decay(this.currentDay),this.woman.changeEmotions(this.currentDay),this.collision.check(this.currentDay),this.collision.checkBreakup(this.currentDay),this.collision.brokenDay&&(this.man.retainDiscontent(),this.woman.retainDiscontent(),this.lastDay=Math.floor(this.collision.brokenDay*1.5)),this.woman.save(),this.man.save(),this.currentDay++}simulateLife(){for(;this.currentDay<this.lastDay;)this.simulateDay()}}class C{constructor(e,t){h(this,"bound","none");h(this,"startDay",0);h(this,"brokenBy",null);h(this,"brokenDay",null);this.man=e,this.woman=t}handleLower(e){this.woman.value>-this.man.value&&this.stop(e)<=2&&this.man.retainCapacity()}handleNone(e){this.woman.value>=this.man.value&&(this.start(e,"upper"),this.woman.addDiscontent()),this.woman.value>0&&this.man.resetDiscontent(),this.woman.value<=-this.man.value&&(this.start(e,"lower"),this.man.looseCapacity(),this.man.addDiscontent(),this.woman.resetDiscontent())}handlePersistentNeglect(){this.woman.value<-this.man.capacity/3&&this.man.isRageFromDiscontent()?this.man.looseCapacity():this.man.addDiscontent()}handleUpper(e){this.woman.value<this.man.value&&this.stop(e)>=2&&this.woman.hate()}shouldCollide(e){return e>this.man.decayDuration&&e>this.woman.decayDuration}start(e,t){this.bound=t,this.startDay=e}stop(e){const t=e-this.startDay;return this.bound="none",this.startDay=0,t}check(e){if(this.shouldCollide(e))switch(this.handlePersistentNeglect(),this.bound){case"none":this.handleNone(e);break;case"upper":this.handleUpper(e);break;case"lower":this.handleLower(e);break}}checkBreakup(e){if(this.brokenDay!=null)return;const t=this.man.value<Math.floor(this.man.capacity/3);(this.woman.value<-this.man.capacity*.8||t)&&(this.brokenDay=e,this.brokenBy=t?"man":"woman")}}class y{constructor(e,t){h(this,"decayDuration");h(this,"decayStep");h(this,"discontent",0);h(this,"history",[]);this.value=e;const[s,i]=t;this.decayDuration=Math.floor(Math.random()*(i-s)+s),this.decayStep=50/this.decayDuration}addDiscontent(){this.discontent++}hate(){this.discontent+=10}isRageFromDiscontent(){const e=Math.min(this.discontent*5,50);return Math.random()*100<=e}save(){this.history.push(this.value)}resetDiscontent(){this.discontent=0}retainDiscontent(){}}class L extends y{constructor(t,s,i){super(t,s);h(this,"bigEmotionDay",30);h(this,"smallEmotionDay",14);h(this,"amplitude",50);this.value=t,this.initialManCapacity=i}emote(t){this.value+=t}getEmotionAmplitude(){return this.amplitude*(1+this.discontent*.05)}addDiscontent(){super.addDiscontent(),this.emote(-(Math.random()*10+10))}changeEmotions(t){if(t>this.decayDuration){const s=this.getEmotionAmplitude();t%this.bigEmotionDay===0?this.emote((Math.random()-.5)*s):(t%this.smallEmotionDay===0||this.isRageFromDiscontent())&&this.emote((Math.random()-.5)*(s/2)),this.value=Math.max(-this.initialManCapacity,Math.min(this.initialManCapacity,this.value))}}decay(t){if(t<=this.decayDuration){const s=(Math.random()-.5)*this.decayStep*5,i=Math.random()<.9?-1:1;this.value+=i*(this.decayStep+s)}}retainDiscontent(){this.discontent>0&&(this.discontent-=this.discontent*.9)}}class P extends y{constructor(t,s){super(t,s);h(this,"resilience",0);h(this,"rancor",.9);this.capacity=t}decay(t){if(t<=this.decayDuration){const s=t/this.decayDuration;this.value=this.capacity-s**2*(this.capacity-100)}}looseCapacity(){this.resilience++,this.value*=this.rancor}retainCapacity(){this.value*=1+.03*this.resilience}retainDiscontent(){this.discontent>0&&(this.discontent-=this.discontent*.5)}}class p{constructor(e){h(this,"ctx");h(this,"logicalHeight",0);h(this,"logicalWidth",0);h(this,"scale",1);h(this,"mapX",e=>e);this.canvas=e,this.ctx=e.getContext("2d"),this.adaptCanvasToContainer(e)}adaptCanvasToContainer(e){this.resize=this.resize.bind(this),this.resize(),new ResizeObserver(this.resize).observe(e)}resize(){const e=window.devicePixelRatio||1,t=this.canvas.getBoundingClientRect(),s=Math.floor(t.width*e),i=Math.floor(t.height*e);(this.canvas.width!==s||this.canvas.height!==i)&&(this.canvas.width=s,this.canvas.height=i,this.logicalWidth=t.width,this.logicalHeight=t.height,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(e,e))}mapY(e){return this.logicalHeight/2-e*this.scale}drawCanvas(e,t,s){this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight),this.mapX=i=>(i-e)/t*this.logicalWidth,this.scale=this.logicalHeight/2*.8/s,this.ctx.lineWidth=1*this.scale}}class S extends p{constructor(e){super(e)}drawAxis(){this.ctx.strokeStyle="#888",this.ctx.beginPath(),this.ctx.moveTo(0,this.mapY(0)),this.ctx.lineTo(this.logicalWidth,this.mapY(0)),this.ctx.stroke()}drawBlueTunnel(e,t,s){this.ctx.fillStyle="rgba(100, 149, 237, 0.15)",this.ctx.beginPath(),this.ctx.moveTo(this.mapX(t),this.mapY(e[t]));for(let i=t;i<s;i++)this.ctx.lineTo(this.mapX(i),this.mapY(e[i]));for(let i=s-1;i>=t;i--)this.ctx.lineTo(this.mapX(i),this.mapY(-e[i]));this.ctx.closePath(),this.ctx.fill()}drawGrayTunnel(e,t,s){this.ctx.fillStyle="rgba(160, 160, 160, 0.15)",this.ctx.beginPath(),this.ctx.moveTo(this.mapX(t),this.mapY(e[t]));for(let i=t;i<s;i++)this.ctx.lineTo(this.mapX(i),this.mapY(e[i]));for(let i=s-1;i>=t;i--)this.ctx.lineTo(this.mapX(i),this.mapY(-e[i]));this.ctx.closePath(),this.ctx.fill()}drawTunnel(e,t,s,i,a){const n=Math.max(i,0),o=t.brokenDay!=null&&t.brokenDay<s?t.brokenDay:Math.min(s,i+a);if(this.drawBlueTunnel(e,n,o),t.brokenDay!=null){const r=Math.max(i,t.brokenDay);this.drawGrayTunnel(e,r,s)}}drawRedLine(e,t,s){this.ctx.beginPath(),this.ctx.strokeStyle="#ff4f8b",this.ctx.moveTo(this.mapX(t),this.mapY(e[0])),t&&this.ctx.moveTo(this.mapX(t),this.mapY(e[t]));for(let i=t;i<s;i++)this.ctx.lineTo(this.mapX(i),this.mapY(e[i]));this.ctx.stroke()}drawGrayLine(e,t,s){this.ctx.beginPath(),this.ctx.strokeStyle="#aaa";let i=0,a=e[t],n=!1;this.ctx.moveTo(this.mapX(t),this.mapY(a));for(let o=t;o<s;o++){const r=e[o];n?this.ctx.lineTo(this.mapX(o),this.mapY(i)):((r===0||r*a<0)&&(n=!0,i=r),this.ctx.lineTo(this.mapX(o),this.mapY(r)),a=r)}this.ctx.stroke()}drawWomanLine(e,t,s,i,a){const n=Math.max(i,0),o=t.brokenDay!=null&&t.brokenDay<s?t.brokenDay:Math.min(s,i+a);this.drawRedLine(e,n,o),t.brokenDay!=null&&s>t.brokenDay&&this.drawGrayLine(e,o,s)}drawMarker(e,t,s){const i=this.mapX(e),a=this.mapY(t);this.ctx.fillStyle="#000",this.ctx.font="24px sans-serif",this.ctx.textAlign="center",this.ctx.fillText("‚úÇÔ∏è",i,this.mapY(-10)),this.ctx.beginPath(),this.ctx.moveTo(i,this.mapY(0)),this.ctx.lineTo(i,a),this.ctx.strokeStyle="#000",this.ctx.stroke(),this.ctx.fillText(s,i,a)}drawBreakup(e,t,s,i){if(s.brokenDay!=null&&i>=s.brokenDay){const a=s.brokenBy==="man",n=a?-e[s.brokenDay]:t[s.brokenDay],o=a?"‚ôÇÔ∏è":"‚ôÄÔ∏è";this.drawMarker(s.brokenDay,n,o)}}draw(e,t,s,i,a,n,o){this.drawCanvas(a,n,o),this.drawAxis(),this.drawTunnel(e,s,i,a,n),this.drawWomanLine(t,s,i,a,n),this.drawBreakup(e,t,s,i)}}class E extends p{constructor(t){super(t);h(this,"currentSpacing",0)}drawCharacter(t,s,i){const r=this.logicalHeight/2-50;this.ctx.save(),this.ctx.strokeStyle=i,this.ctx.fillStyle=i,this.ctx.lineWidth=8,this.ctx.beginPath(),this.ctx.moveTo(t,r),this.ctx.lineTo(t,r+40),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t-20,r+40/2),this.ctx.lineTo(t+20,r+40/2),this.ctx.stroke();const l=r+40;this.ctx.beginPath(),this.ctx.moveTo(t,l),this.ctx.lineTo(t-20,l+20),this.ctx.moveTo(t,l),this.ctx.lineTo(t+20,l+20),this.ctx.stroke(),this.ctx.font="32px serif",this.ctx.textAlign="center",this.ctx.fillText(s,t,r+5),this.ctx.restore()}getEmoji(t,s,i){return s.brokenDay&&i>=s.brokenDay?"üòê":i<t.decayDuration||t.history[i]>100?"üòç":t.history[i]>80?"üòä":t.history[i]<60?"ü•∫":t.history[i]<0?"üò°":t.discontent>20?"üò≠":t.discontent>10?"üò°":t.discontent>5?"üòï":"üòê"}draw(t,s,i,a,n,o){this.drawCanvas(0,n,o);const r=Math.max(0,Math.min(a,t.history.length-1,s.history.length-1));this.ctx.clearRect(0,0,this.logicalWidth,this.logicalHeight);const l=this.logicalWidth*.9,D=Math.abs(s.history[r]-t.history[r])*2,x=Math.min(D,l),d=this.logicalWidth/2,w=.1;this.currentSpacing+=(x-this.currentSpacing)*w;const b=d-this.currentSpacing/2,v=d+this.currentSpacing/2;this.drawCharacter(b,this.getEmoji(t,i,r),"#4682B4"),this.drawCharacter(v,this.getEmoji(s,i,r),"#FF69B4")}}class Y{constructor(e,t,s,i,a=10,n){h(this,"currentDay",0);h(this,"frameId",null);h(this,"isPlaying",!1);h(this,"lastTickTime",0);h(this,"graph");h(this,"scene");h(this,"timeline");this.man=e,this.woman=t,this.collision=s,this.totalDays=i,this.speed=a,this.frameDays=n,this.graph=new S(document.getElementById("graph")),this.scene=new E(document.getElementById("scene")),this.timeline=document.getElementById("timeline"),this.setupCanvasDrag(document.getElementById("graph")),this.timeline.max=String(i),this.timeline.oninput=()=>this.seek(Number(this.timeline.value))}setupCanvasDrag(e){let t=!1,s=0;const i=e.clientWidth/this.frameDays,a=n=>{const o=n-s;s=n;const r=Math.round(o/i);this.seek(this.currentDay-r)};e.addEventListener("mousedown",n=>{t=!0,s=n.clientX}),window.addEventListener("mousemove",n=>{t&&a(n.clientX)}),window.addEventListener("mouseup",()=>{t=!1}),e.addEventListener("touchstart",n=>{n.touches.length===1&&(t=!0,s=n.touches[0].clientX)},{passive:!0}),window.addEventListener("touchmove",n=>{!t||n.touches.length!==1||(n.preventDefault(),a(n.touches[0].clientX))},{passive:!1}),window.addEventListener("touchend",()=>{t=!1})}updateFrame(){const e=Math.max(0,this.currentDay-this.frameDays);this.graph.draw(this.man.history,this.woman.history,this.collision,this.currentDay,e,this.frameDays,this.man.capacity),this.scene.draw(this.man,this.woman,this.collision,this.currentDay-1,this.frameDays,this.man.capacity),this.timeline.value=String(this.currentDay),this.currentDay++}play(){this.isPlaying||(this.isPlaying=!0,this.frameId=requestAnimationFrame(e=>this.tick(e)))}pause(){this.frameId&&cancelAnimationFrame(this.frameId),this.isPlaying=!1}stop(){this.pause(),this.currentDay=0,this.frameId=null,this.lastTickTime=0}forward(e=10){this.pause(),this.currentDay=Math.min(this.totalDays,this.currentDay+e),this.updateFrame()}rewind(e=10){this.pause(),this.currentDay=Math.max(0,this.currentDay-e),this.updateFrame()}seek(e){this.pause(),this.currentDay=Math.max(0,Math.min(this.totalDays,e)),this.updateFrame()}tick(e=0){this.currentDay<=this.totalDays?(e-this.lastTickTime>=this.speed&&(this.updateFrame(),this.lastTickTime=e),this.frameId=requestAnimationFrame(t=>this.tick(t))):this.stop()}}const m=new P(150,[14,90]),u=new L(150,[14,90],m.value),g=new C(m,u),X=100*365,f=new M(m,u,g,X);f.simulateLife();const B=new Y(m,u,g,f.lastDay,10,365);B.play();
